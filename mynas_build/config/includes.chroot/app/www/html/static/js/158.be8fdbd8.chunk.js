"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[158,523],{41523:function(t,e,r){r.r(e);var n=r(47313),o=r(75908),i=r(9289),a=r(61113),s=r(47131),l=r(24272),p=r(96944),u=r(36555),c=r(8586),d=(r(37982),r(46417)),f=(0,n.forwardRef)((function(t,e){var r=t.onActive,n=t.onClose,f=t.onRestore,m=t.onMaximize,g=t.onMinimize;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(o.Z,{sx:{position:"relative"},children:(0,d.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,d.jsx)(a.Z,{variant:"h6",component:"div",sx:{flexGrow:1,cursor:"move"},className:"window-title",onClick:r,children:t.title}),(0,d.jsx)(s.Z,{color:"inherit",onClick:g,children:(0,d.jsx)(l.Z,{})}),t.isMaximized?(0,d.jsx)(s.Z,{color:"inherit",onClick:f,children:(0,d.jsx)(p.Z,{})}):(0,d.jsx)(s.Z,{color:"inherit",onClick:m,children:(0,d.jsx)(u.Z,{})}),(0,d.jsx)(s.Z,{color:"inherit",onClick:n,children:(0,d.jsx)(c.Z,{})})]})}),t.children]})}));e.default=f},40158:function(t,e,r){r.r(e);var n=r(74165),o=r(15861),i=r(29439),a=r(1413),s=r(47313),l=r(96467),p=r(75908),u=r(10437),c=r(66149),d=r(33604),f=r(4117),m=r(69099),g=r(40762),v=r(10724),b=r(24931),h=r(37982),y=(r(46817),r(60786)),x=(r(66641),r(60270)),_=(r(147),r(41523)),Z=r(46417),k=((0,v.Z)(l.Z)({width:"80%"}),(0,v.Z)("main",{shouldForwardProp:function(t){return"open"!==t}})((function(t){var e=t.theme,r=t.open;return(0,a.Z)({flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:"-".concat(240,"px")},r&&{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0})})),(0,v.Z)(p.Z,{shouldForwardProp:function(t){return"open"!==t}})((function(t){var e=t.theme,r=t.open;return(0,a.Z)({transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},r&&{width:"calc(100% - ".concat(240,"px)"),marginLeft:"".concat(240,"px"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})})})),(0,v.Z)("div")((function(t){var e=t.theme;return(0,a.Z)((0,a.Z)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"})})),function(t){var e=(0,s.useRef)(null),r=(0,s.useRef)(null),n=(0,s.useState)(""),o=(0,i.Z)(n,2);o[0],o[1];return(0,s.useEffect)((function(){e.current=new y.Terminal({rows:40,convertEol:!0,scrollback:10,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0});var n=new x.FitAddon;e.current.loadAddon(n),e.current.onResize((function(t){n.fit()})),e.current.open(r.current),null!=t.data&&b.default[t.data.op]({stdout:function(t){console.log("up_container=",t),e.current&&e.current.write(t)},stderr:function(t){console.log("up_container stderr=",t)},onerr:function(t){console.log("up_container err=",t)},onend:function(){t.onEnd&&t.onEnd()}})}),[t]),(0,Z.jsx)(u.Z,{ref:r,width:"100vh",height:"100vh"})});e.default=function(t){var e=(0,h.useData)(),r=(e.global_data,e.api),p=(0,s.useState)({install_virt_manager:!1,run_virt_manager:!1,install_dialog:!1,drawOpen:!1,run_cmd:{},openAddDialog:!1,networks:[],json_editor_option:{disable_edit_json:!0,disable_properties:!0,disable_collapse:!0,no_additional_properties:!0,required_by_default:!0},schema:{$ref:"#/definitions/qemu",definitions:{object:{type:"string",title:"Object",format:"json",default:"{}",options:{ace:{theme:"ace/theme/vibrant_ink",tabSize:2,useSoftTabs:!0,wrap:!0}}},cdrom:{type:"object",title:"\u5149\u76d8\u8bbe\u7f6e",format:"grid",properties:{filename:{type:"string",default:"",title:"ISO\u6587\u4ef6\u8def\u5f84"},bus_options:{type:"string",default:"VirtIO",title:"\u603b\u7ebf\u7c7b\u578b",enum:["VirtIO","scsi","sate","ide","usb"],options:{enum_titles:["VirtIO","scsi","sate","ide","usb"]}},boot_order:{type:"integer",default:2,title:"\u542f\u52a8\u987a\u5e8f"}},required:["filename","bus_options","boot_order"]},disk:{type:"object",title:"\u78c1\u76d8",properties:{filename:{type:"string",default:"",title:"\u78c1\u76d8\u6587\u4ef6\u8def\u5f84"},size:{type:"string",default:"1G",title:"\u78c1\u76d8\u5927\u5c0f"},type:{type:"string",default:"qcow2",title:"\u865a\u62df\u78c1\u76d8\u7c7b\u578b",enum:["qcow2","raw"],options:{enum_titles:["qcow2","raw"]}},bus_options:{type:"string",default:"VirtIO",title:"\u603b\u7ebf\u7c7b\u578b",enum:["VirtIO","scsi","sate","ide","usb"],options:{enum_titles:["VirtIO","scsi","sate","ide","usb"]}},boot_order:{type:"integer",default:1,title:"\u542f\u52a8\u987a\u5e8f"}},required:["filename","size","type","bus_options","boot_order"]},share:{type:"object",title:"\u5171\u4eab",properties:{mode:{type:"string",default:"",title:"\u865a\u62df\u78c1\u76d8\u7c7b\u578b",enum:["9p","virtiofs"],options:{enum_titles:["9p Mode","Virtiofs Mode"]}},source:{type:"string",default:"",title:"\u4e3b\u673a\u76ee\u5f55"},target:{type:"string",default:"",title:"\u865a\u62df\u673a\u6302\u8f7d\u6807\u7b7e"}},required:["mode","source","target"]},gpu:{type:"object",title:"\u663e\u5361",properties:{id:{type:"string",default:"virtual",title:"\u865a\u62df\u78c1\u76d8\u7c7b\u578b",enum:["virtual"],options:{enum_titles:["virtual"]}},source:{type:"string",default:"",title:"\u4e3b\u673a\u76ee\u5f55"},target:{type:"string",default:"",title:"\u865a\u62df\u673a\u6302\u8f7d\u6807\u7b7e"}},required:["mode","source","target"]},machine:{type:"string",title:"Machine",default:"pc-q35-7.1",enum:["pc-q35-7.1","pc-i440fx-6.2"],options:{enum_titles:["pc-q35-7.1","pc-i440fx-6.2"]}},overcommit:{type:"string",title:"overcommit",default:"mem-lock=off",options:{hidden:!0}},smp:{type:"string",title:"\u903b\u8f91CPU",format:"vm_smp",default:"1,sockets=1,dies=1,cores=1,threads=1"},chardev:{type:"string",title:"chardev",default:""},mon:{type:"string",title:"mon",default:""},global:{type:"string",title:"global",default:""},rtc:{type:"string",title:"rtc",default:""},boot:{type:"string",title:"boot",default:""},device:{type:"string",title:"device",format:"json",default:"{}",options:{ace:{theme:"ace/theme/vibrant_ink",tabSize:2,useSoftTabs:!0,wrap:!0}}},netdev:{type:"string",title:"netdev",default:""},audiodev:{type:"string",format:"json",default:"{}",options:{ace:{theme:"ace/theme/vibrant_ink",tabSize:2,useSoftTabs:!0,wrap:!0}}},vnc_auto_port:{type:"object",title:"\u81ea\u52a8",properties:{type:{type:"string",default:"auto_port",options:{hidden:!0}},auto_port:{type:"boolean",default:!0,options:{hidden:!0}}},required:["auto_port","type"]},vnc_port:{type:"object",title:"\u624b\u52a8",properties:{type:{type:"string",default:"port",options:{hidden:!0}},port:{type:"integer",title:"\u76d1\u542c\u7aef\u53e3",default:-1},ws_port:{type:"integer",title:"\u7f51\u9875\u7aef\u53e3",default:-1}},required:["port","ws_port","type"]},vnc:{type:"object",title:"VNC",properties:{id:{type:"string",default:"virtual",options:{hidden:!0}},protocol:{type:"string",default:"vnc",title:"VM Console Protocol:",enum:["vnc","spice"],options:{enum_titles:["VNC","SPICE"]}},port:{type:"object",title:"\u7aef\u53e3",anyOf:[{$ref:"#/definitions/vnc_auto_port"},{$ref:"#/definitions/vnc_port"}]},model:{type:"string",title:"\u9a71\u52a8\u6a21\u5f0f",default:"qxl",enum:["cirrus","qxl","vmvga"],options:{enum_titles:["Cirrus","QXL (best)","vmvga"]}},keymap:{type:"string",title:"VNC\u952e\u76d8",default:"en-us"},password:{type:"string",title:"VNC\u5bc6\u7801",default:""}},required:["id","protocol","port","model","keymap","password"]},nic:{type:"object",title:"\u7f51\u5361",properties:{mac:{type:"string",title:"MAC\u5730\u5740",default:""},network:{type:"string",title:"source",default:""},model:{type:"string",title:"\u7f51\u7edc\u6a21\u5f0f",default:"virtio-net",enum:["virtio-net","virtio","e1000","vmxnet3"],options:{enum_titles:["virtio-net","virtio","e1000","vmxnet3"]}},boot:{type:"integer",title:"\u542f\u52a8\u987a\u5e8f",default:0}},required:["mac","network","model","boot"]},sandbox:{type:"string",title:"sandbox",default:"on,obsolete=deny,elevateprivileges=deny,spawn=deny,resourcecontrol=deny"},msg:{type:"string",title:"msg",default:"timestamp=on"},qemu:{type:"object",title:"\u865a\u62df\u673a\u914d\u7f6e",properties:{name:{type:"string",title:"\u540d\u79f0",default:""},cpu:{type:"string",title:"cpu\u8bbe\u7f6e",enum:["host,migratable=on,host-cache-info=on,l3-cache=off","qemu64"],options:{enum_titles:["\u4e3b\u673a\u76f4\u901a","qemu\u6a21\u62df"]},default:"host,migratable=on,host-cache-info=on,l3-cache=off"},smp:{$ref:"#/definitions/smp"},memory:{type:"integer",title:"\u5185\u5b58\uff08MB\uff09",default:1024},max_memory:{type:"integer",title:"\u6700\u5927\u5185\u5b58\uff08MB\uff09",default:1024},machine:{$ref:"#/definitions/machine"},bios:{type:"string",default:"OVMF",title:"bios\u9009\u62e9",enum:["SeaBIOS","OVMF","OVMF TPM"],options:{enum_titles:["SeaBIOS","OVMF","OVMF TPM"]}},usbboot:{type:"boolean",default:!1,title:"usb\u542f\u52a8"},usbmode:{type:"string",default:"usb2",enum:["usb2","usb3","usb3-qemu"],options:{enum_titles:["2.0 (EHCI)","3.0 (nec XHCI)","3.0 (qemu XHCI)"]}},cdrom:{$ref:"#/definitions/cdrom"},disks:{type:"array",title:"\u78c1\u76d8\u914d\u7f6e",format:"table",items:{$ref:"#/definitions/disk"}},share:{type:"array",title:"\u5171\u4eab\u914d\u7f6e",format:"table",items:{$ref:"#/definitions/share"}},gpu:{type:"array",title:"\u663e\u5361\u914d\u7f6e",items:{type:"object",title:"\u663e\u5361",anyOf:[{$ref:"#/definitions/vnc"}]}},nic:{type:"array",title:"\u7f51\u8def\u914d\u7f6e",items:{$ref:"#/definitions/nic"}},uuid:{type:"string",default:"",options:{hidden:!0}}},required:["name","cpu","smp","memory","max_memory","machine","bios","usbboot","usbmode","cdrom","disks","share","gpu","nic","uuid"]}}}}),u=(0,i.Z)(p,2),y=u[0],x=u[1],w=function(t){x((function(e){return(0,a.Z)((0,a.Z)({},e),t)}))},j=function(){var t=(0,o.Z)((0,n.Z)().mark((function t(){var e,o,i,a,s,l,p;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.default.check_virt_manager();case 2:if(e=t.sent,o=!1,i=!1,0!=e.ret||!e.data){t.next=17;break}if(a=e.data.stdout,o=!0,""!=a){t.next=16;break}return o=!0,t.next=12,r.run_command({command:"/bin/bash",args:["./scripts/get_ip.sh"]});case 12:0==(s=t.sent).ret&&(l=JSON.parse(s.data.stdout),p=l.map((function(t){return t.ipv4=t.ipv4.split("\n"),t.ipv6=t.ipv6.split("\n"),t})),w({install_virt_manager:o,run_virt_manager:i=!0,networks:p})),t.next=17;break;case 16:a.includes("not installed")||(o=!0,a.includes("not run")||(i=!0));case 17:w({install_virt_manager:o,run_virt_manager:i});case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,s.useEffect)((function(){j()}),[]);var C=function(){var t={};console.log("state===",y),y.install_virt_manager?y.run_virt_manager||(t={op:"run_virt_manager"}):t={op:"install_virt_manager"},t.op?w({install_dialog:!0,run_command:t}):w({install_dialog:!1})},M=(t.onActive,t.onClose,t.onRestore,t.onMaximize,t.onMinimize,(0,s.useRef)(null),(0,v.Z)(l.Z)({width:"80%"})),S=window.location,B="";return y.networks.length>0&&(B="http://".concat(y.networks[0].ipv4[0],":8185")),console.log("state===",y,S),(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(_.default,(0,a.Z)((0,a.Z)({title:"\u865a\u62df\u673a\u7ba1\u7406"},t),{},{children:(0,Z.jsxs)(g.Z,{children:[(!y.install_virt_manager||!y.run_virt_manager)&&(0,Z.jsx)(m.Z,{onClick:C,children:"\u5b89\u88c5\u865a\u62df\u673a\u7ba1\u7406"}),y.run_virt_manager&&(0,Z.jsx)("iframe",{src:B,frameborder:"0",style:{border:"0px",width:"100%",height:"100%",bottom:"0px",left:"0px",right:"0px",top:"0px",position:"fixed"},allowfullscreen:!0}),y.install_dialog&&(0,Z.jsxs)(c.Z,{open:y.install_dialog,onClose:function(){return console.log("close")},children:[(0,Z.jsx)(d.Z,{children:"\u521d\u59cb\u5316"}),(0,Z.jsx)(M,{children:(0,Z.jsx)(k,{data:y.run_command,onEnd:function(){w({install_dialog:!1}),setTimeout((0,o.Z)((0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j();case 2:setTimeout((function(){C()}));case 3:case"end":return t.stop()}}),t)}))))}})}),(0,Z.jsx)(f.Z,{})]})]})}))})}},8586:function(t,e,r){var n=r(81171),o=r(46417);e.Z=(0,n.Z)((0,o.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},36555:function(t,e,r){var n=r(81171),o=r(46417);e.Z=(0,n.Z)((0,o.jsx)("path",{d:"M3 3h18v2H3z"}),"Maximize")},24272:function(t,e,r){var n=r(81171),o=r(46417);e.Z=(0,n.Z)((0,o.jsx)("path",{d:"M6 19h12v2H6z"}),"Minimize")},96944:function(t,e,r){var n=r(81171),o=r(46417);e.Z=(0,n.Z)((0,o.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"}),"Restore")},75908:function(t,e,r){r.d(e,{Z:function(){return y}});var n=r(63366),o=r(87462),i=r(47313),a=r(83061),s=r(21921),l=r(17592),p=r(77342),u=r(91615),c=r(70501),d=r(77430),f=r(32298);function m(t){return(0,f.Z)("MuiAppBar",t)}(0,d.Z)("MuiAppBar",["root","positionFixed","positionAbsolute","positionSticky","positionStatic","positionRelative","colorDefault","colorPrimary","colorSecondary","colorInherit","colorTransparent"]);var g=r(46417),v=["className","color","enableColorOnDark","position"],b=function(t,e){return t?"".concat(null==t?void 0:t.replace(")",""),", ").concat(e,")"):e},h=(0,l.ZP)(c.Z,{name:"MuiAppBar",slot:"Root",overridesResolver:function(t,e){var r=t.ownerState;return[e.root,e["position".concat((0,u.Z)(r.position))],e["color".concat((0,u.Z)(r.color))]]}})((function(t){var e=t.theme,r=t.ownerState,n="light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[900];return(0,o.Z)({display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",flexShrink:0},"fixed"===r.position&&{position:"fixed",zIndex:(e.vars||e).zIndex.appBar,top:0,left:"auto",right:0,"@media print":{position:"absolute"}},"absolute"===r.position&&{position:"absolute",zIndex:(e.vars||e).zIndex.appBar,top:0,left:"auto",right:0},"sticky"===r.position&&{position:"sticky",zIndex:(e.vars||e).zIndex.appBar,top:0,left:"auto",right:0},"static"===r.position&&{position:"static"},"relative"===r.position&&{position:"relative"},!e.vars&&(0,o.Z)({},"default"===r.color&&{backgroundColor:n,color:e.palette.getContrastText(n)},r.color&&"default"!==r.color&&"inherit"!==r.color&&"transparent"!==r.color&&{backgroundColor:e.palette[r.color].main,color:e.palette[r.color].contrastText},"inherit"===r.color&&{color:"inherit"},"dark"===e.palette.mode&&!r.enableColorOnDark&&{backgroundColor:null,color:null},"transparent"===r.color&&(0,o.Z)({backgroundColor:"transparent",color:"inherit"},"dark"===e.palette.mode&&{backgroundImage:"none"})),e.vars&&(0,o.Z)({},"default"===r.color&&{"--AppBar-background":r.enableColorOnDark?e.vars.palette.AppBar.defaultBg:b(e.vars.palette.AppBar.darkBg,e.vars.palette.AppBar.defaultBg),"--AppBar-color":r.enableColorOnDark?e.vars.palette.text.primary:b(e.vars.palette.AppBar.darkColor,e.vars.palette.text.primary)},r.color&&!r.color.match(/^(default|inherit|transparent)$/)&&{"--AppBar-background":r.enableColorOnDark?e.vars.palette[r.color].main:b(e.vars.palette.AppBar.darkBg,e.vars.palette[r.color].main),"--AppBar-color":r.enableColorOnDark?e.vars.palette[r.color].contrastText:b(e.vars.palette.AppBar.darkColor,e.vars.palette[r.color].contrastText)},{backgroundColor:"var(--AppBar-background)",color:"inherit"===r.color?"inherit":"var(--AppBar-color)"},"transparent"===r.color&&{backgroundImage:"none",backgroundColor:"transparent",color:"inherit"}))})),y=i.forwardRef((function(t,e){var r=(0,p.Z)({props:t,name:"MuiAppBar"}),i=r.className,l=r.color,c=void 0===l?"primary":l,d=r.enableColorOnDark,f=void 0!==d&&d,b=r.position,y=void 0===b?"fixed":b,x=(0,n.Z)(r,v),_=(0,o.Z)({},r,{color:c,position:y,enableColorOnDark:f}),Z=function(t){var e=t.color,r=t.position,n=t.classes,o={root:["root","color".concat((0,u.Z)(e)),"position".concat((0,u.Z)(r))]};return(0,s.Z)(o,m,n)}(_);return(0,g.jsx)(h,(0,o.Z)({square:!0,component:"header",ownerState:_,elevation:4,className:(0,a.default)(Z.root,i,"fixed"===y&&"mui-fixed"),ref:e},x))}))},9289:function(t,e,r){r.d(e,{Z:function(){return b}});var n=r(4942),o=r(63366),i=r(87462),a=r(47313),s=r(83061),l=r(21921),p=r(77342),u=r(17592),c=r(77430),d=r(32298);function f(t){return(0,d.Z)("MuiToolbar",t)}(0,c.Z)("MuiToolbar",["root","gutters","regular","dense"]);var m=r(46417),g=["className","component","disableGutters","variant"],v=(0,u.ZP)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:function(t,e){var r=t.ownerState;return[e.root,!r.disableGutters&&e.gutters,e[r.variant]]}})((function(t){var e=t.theme,r=t.ownerState;return(0,i.Z)({position:"relative",display:"flex",alignItems:"center"},!r.disableGutters&&(0,n.Z)({paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},e.breakpoints.up("sm"),{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}),"dense"===r.variant&&{minHeight:48})}),(function(t){var e=t.theme;return"regular"===t.ownerState.variant&&e.mixins.toolbar})),b=a.forwardRef((function(t,e){var r=(0,p.Z)({props:t,name:"MuiToolbar"}),n=r.className,a=r.component,u=void 0===a?"div":a,c=r.disableGutters,d=void 0!==c&&c,b=r.variant,h=void 0===b?"regular":b,y=(0,o.Z)(r,g),x=(0,i.Z)({},r,{component:u,disableGutters:d,variant:h}),_=function(t){var e=t.classes,r={root:["root",!t.disableGutters&&"gutters",t.variant]};return(0,l.Z)(r,f,e)}(x);return(0,m.jsx)(v,(0,i.Z)({as:u,className:(0,s.default)(_.root,n),ref:e,ownerState:x},y))}))}}]);