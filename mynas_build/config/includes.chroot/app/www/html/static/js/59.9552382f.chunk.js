"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[59,8,569,889],{89008:function(e,t,n){n.r(t);var a=n(37762),r=n(93433),o=n(1413),s=n(29439),c=n(47313),i=n(51629),u=n(70501),l=n(66835),d=n(23477),f=n(24076),p=n(67478),h=n(57861),m=n(69099),g=n(99783),v=n(37982),Z=n(46417);t.default=function(e){var t=(0,v.useData)(),n=t.global_data,x=(t.api,(0,c.useState)([])),_=(0,s.Z)(x,2),b=_[0],k=(_[1],(0,c.useState)(!0)),y=(0,s.Z)(k,2),j=(y[0],y[1],(0,c.useState)(0)),w=(0,s.Z)(j,2),S=w[0],C=w[1],z=(0,c.useState)(10),I=(0,s.Z)(z,2),D=I[0],E=I[1],O=(0,c.useState)({online:!1,status_text:"\u79bb\u7ebf"}),P=(0,s.Z)(O,2),A=(P[0],P[1],(0,c.useState)({data:[],disks:e.data||[]})),J=(0,s.Z)(A,2),N=J[0],R=J[1],q=function(e){R((function(t){return(0,o.Z)((0,o.Z)({},t),e)}))},T=(0,c.useState)(""),$=(0,s.Z)(T,2),B=$[0],L=($[1],N.disks.filter((function(e){return Object.values(e).some((function(e){return e.toString().toLowerCase().includes(B.toLowerCase())}))})));return(0,c.useEffect)((function(){q({disks:e.data});n.get("blockdevices");var t=function(t){var s,c=n.get("blockdevices"),i=b,u=(0,r.Z)(N.disks),l=(0,a.Z)(e.data);try{var d=function(){var e=s.value,t=u.findIndex((function(t){return t.path==e.path}));t<0&&u.push(e)};for(l.s();!(s=l.n()).done;)d()}catch(p){l.e(p)}finally{l.f()}var f=t;i.forEach((function(e){var t=f.filter((function(t){return e.path=="/dev/".concat(t.Device)}))[0];if(c){var n=c.filter((function(t){return t.path===e.path}))[0];if(t&&n){var a=u.findIndex((function(t){return t.path==e.path}));a>=0?u.splice(a,1,(0,o.Z)((0,o.Z)({},n),{},{id:e.path},t)):u.push((0,o.Z)((0,o.Z)({},n),{},{id:e.path},t))}}})),q({disks:(0,r.Z)(u)})};return n.watch("sysstat",t),function(){n.unwatch("sysstat",t)}}),[e.data]),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(i.Z,{component:u.Z,children:(0,Z.jsxs)(l.Z,{children:[(0,Z.jsx)(d.Z,{children:(0,Z.jsxs)(f.Z,{children:[(0,Z.jsx)(p.Z,{children:"\u8bbe\u5907"}),(0,Z.jsx)(p.Z,{children:"PATH"}),(0,Z.jsx)(p.Z,{children:"\u6807\u8bc6"}),(0,Z.jsx)(p.Z,{children:"\u5bb9\u91cf"}),(0,Z.jsx)(p.Z,{children:"\u8bfb\u53d6"}),(0,Z.jsx)(p.Z,{children:"\u5199\u5165"})]})}),(0,Z.jsx)(h.Z,{children:L.slice(S*D,S*D+D).map((function(t){return(0,Z.jsxs)(f.Z,{children:[(0,Z.jsxs)(p.Z,{children:[e.onDown&&(0,Z.jsx)(m.Z,{onClick:function(){return e.onDown(t)},children:"\u4e0b\u7ebf"}),e.onAdd&&e.check_add_status&&e.check_add_status(t)&&(0,Z.jsx)(m.Z,{onClick:function(){return e.onAdd(t)},children:"\u6dfb\u52a0\u5230\u6c60"}),e.onRemove&&(0,Z.jsx)(m.Z,{onClick:function(){return e.onRemove(t)},children:"\u79fb\u9664"})]}),(0,Z.jsx)(p.Z,{children:t.path}),(0,Z.jsxs)(p.Z,{children:[t.model," ",t.serial," ",t.size]}),(0,Z.jsx)(p.Z,{children:t.size}),(0,Z.jsx)(p.Z,{children:t["kB_read/s"]}),(0,Z.jsx)(p.Z,{children:t["kB_wrtn/s"]})]},t.path)}))})]})}),(0,Z.jsx)(g.Z,{component:"div",count:L.length,page:S,onPageChange:function(e,t){C(t)},rowsPerPage:D,onRowsPerPageChange:function(e){E(parseInt(e.target.value,10)),C(0)},style:{marginTop:"1rem"}})]})}},57059:function(e,t,n){n.r(t);var a=n(37762),r=n(1413),o=n(93433),s=n(74165),c=n(15861),i=n(29439),u=n(47313),l=n(4434),d=n(46817),f=n(9569),p=n(10724),h=n(96467),m=n(66149),g=n(33604),v=n(4117),Z=n(69099),x=n(71889),_=n(37982),b=n(89008),k=n(46417);t.default=function(){var e=(0,u.useState)([]),t=(0,i.Z)(e,2),n=t[0],y=t[1],j=(0,u.useState)([]),w=(0,i.Z)(j,2),S=w[0],C=w[1],z=(0,u.useState)({id:0,key:"",status:0,type:0,value:"",parent_id:0}),I=(0,i.Z)(z,2),D=I[0],E=(I[1],(0,u.useState)(!0)),O=(0,i.Z)(E,2),P=(O[0],O[1],(0,u.useContext)(_.DataContext)),A=(0,u.useState)({}),J=(0,i.Z)(A,2),N=J[0],R=J[1],q=(0,u.useState)(!1),T=(0,i.Z)(q,2),$=T[0],B=T[1];(0,u.useEffect)((function(){var e=function(e){y(e)};P.watch("blockdevices",e);var t=P.get("pools",[],(0,c.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.config_file({filename:"config/pools.config",op:"get"});case 2:0==(t=e.sent).ret&&(n=JSON.parse(t.data),C(n),P.set("pools",n));case 4:case"end":return e.stop()}}),e)}))));C(t);var n=function(e){console.log("update pools=",e),C((0,o.Z)(e)),console.log("after pools=",S)};return console.log("watch pools"),P.watch("pools",n),l.default.disk_info({}),function(){P.unwatch("blockdevices",e),console.log("unwatch pools"),P.unwatch("pools",n)}}),[]);var L=(0,u.useRef)(null),W=function(){B(!1)},F=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(){var t,n,a,o,c,i,u,d,f,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=L.current.getValue(),console.log("save===",t),e.t0=t.op,e.next="add_device_to_pool"===e.t0?6:"addpool"===e.t0?21:41;break;case 6:return console.log("add device to pool",t),n=S.findIndex((function(e){return e.name==t.pool})),a=null,n>=0&&(a=S[n]),e.next=12,l.default.run_command((0,r.Z)({},x.default.device.add((0,r.Z)((0,r.Z)({},t),{},{mount_path:a.mount_path}))));case 12:if(0!=e.sent.ret){e.next=20;break}return(o=a.label.findIndex((function(e){return e.path==t.device})))>=0?a.label.splice(o,1,(0,r.Z)((0,r.Z)({},a.label[o]),{},{name:t.label,path:t.device})):a.label.push({name:t.label,path:t.device}),e.next=18,l.default.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(S)});case 18:0==e.sent.ret&&(P.set("pools",S),B(!1));case 20:return e.abrupt("break",41);case 21:return e.next=23,l.default.run_command((0,r.Z)((0,r.Z)({},x.default.format(t)),{},{config:t}));case 23:if(c=e.sent,console.log("format_ret===",c),0!=c.ret){e.next=40;break}return i=t.name,(d=(u=S).findIndex((function(e){return e.name==i})))>=0?u.split(d,1,t):u.push(t),P.set("pools",u),e.next=33,l.default.config_file({op:"put",filename:"config/pools.config",data:JSON.stringify(u)});case 33:if(0==(f=e.sent).ret&&console.log("write_config ok=",f),1!=t.auto_mount){e.next=40;break}return e.next=38,l.default.run_command((0,r.Z)((0,r.Z)({},x.default.mount(t)),{},{config:t}));case 38:p=e.sent,console.log("mount_ret===",p);case 40:return e.abrupt("break",41);case 41:e.next=46;break;case 43:e.prev=43,e.t1=e.catch(0),console.error("Error saving parameter:",e.t1);case 46:case"end":return e.stop()}}),e,null,[[0,43]])})));return function(){return e.apply(this,arguments)}}(),H=(0,p.Z)(h.Z)({width:"80%"}),V=function(){return(0,k.jsxs)(m.Z,{open:$,onClose:W,fullWidth:!0,maxWidth:"md",children:[(0,k.jsx)(g.Z,{children:"\u6dfb\u52a0\u53c2\u6570"}),(0,k.jsx)(H,{children:(0,k.jsx)(d.default,{schema:N,ref:L,data:D})}),(0,k.jsxs)(v.Z,{children:[(0,k.jsx)(Z.Z,{onClick:F,children:"\u4fdd\u5b58"}),(0,k.jsx)(Z.Z,{onClick:W,children:"\u53d6\u6d88"})]})]})},G=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.config_file({filename:"disk.config",op:"get"});case 2:if(t=e.sent,console.log("disk_config==",t),-2!=t.ret){e.next=9;break}return e.next=7,l.default.config_file({filename:"disk.config",op:"put",data:JSON.stringify({blockdevices:P.get("blockdevices")})});case 7:n=e.sent,console.log("d_w_ret=",n);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e,t=[],n=(0,a.Z)(S);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push((0,k.jsx)(f.default,{data:r},r))}}catch(o){n.e(o)}finally{n.f()}return t};return(0,k.jsxs)("div",{children:[(0,k.jsx)(Z.Z,{onClick:function(e){e.preventDefault();R({$ref:"#/definitions/bcachefs_config",definitions:{bcachefs_label:{type:"array",title:"\u6807\u7b7e\u914d\u7f6e",uniqueItems:!0,items:{type:"object",headerTemplate:"{{self.name}}={{self.path}}",properties:{name:{type:"string",default:"",title:"label_name"},path:{type:"string",format:"disk_select",title:"\u8bbe\u5907"},model:{type:"string",title:"\u786c\u76d8",options:{hidden:!0}}},required:["name","path","model"]}},bcachefs_config:{type:"object",properties:{op:{type:"string",default:"addpool",options:{hidden:!0}},name:{type:"string",title:"\u540d\u79f0",default:"pool"},compression:{type:"string",title:"\u538b\u7f29\u65b9\u5f0f",enum:["none","lz4","gzip","zstd"],default:"none",options:{enum_titles:["none","lz4","gzip","zstd"]}},encrypted:{type:"boolean",title:"\u52a0\u5bc6",default:!1},replicas:{type:"integer",title:"\u6570\u636e\u526f\u672c\u6570\u91cf",default:1},foreground_target:{type:"string",title:"\u524d\u7aef\u8bbe\u5907\u6807\u7b7e",default:""},promote_target:{type:"string",title:"promote_target\u8bbe\u5907\u6807\u7b7e",default:""},background_target:{type:"string",title:"\u540e\u7aef\u8bbe\u5907\u6807\u7b7e",default:""},label:{title:"\u5b58\u50a8\u6807\u7b7e\u8bbe\u7f6e",$ref:"#/definitions/bcachefs_label"},auto_mount:{type:"boolean",title:"\u81ea\u52a8\u6302\u8f7d",default:!1},mount_path:{type:"string",title:"\u6302\u8f7d\u8def\u5f84",default:"/mnt"}},required:["op","name","compression","encrypted","replicas","foreground_target","promote_target","background_target","label","auto_mount","mount_path"]}}}),B(!0)},children:"\u6dfb\u52a0\u6c60"}),(0,k.jsx)(Z.Z,{onClick:G,children:"test"}),(0,k.jsx)(V,{}),(0,k.jsx)(K,{}),(0,k.jsx)(b.default,{data:n,onAdd:function(e){console.log("onAdd");var t=S.map((function(e){return e.name}));console.log("pools==",t),R({$ref:"#/definitions/config",definitions:{config:{type:"object",title:"\u52a0\u5165\u5230\u6c60",properties:{op:{type:"string",default:"add_device_to_pool",options:{hidden:!0}},device:{type:"string",default:e.path,options:{hidden:!0}},pool:{type:"string",title:"\u6c60\u540d\u5b57",enum:t,options:{enum_titles:t}},label:{type:"string",title:"\u6807\u7b7e",default:""},fs_size:{type:"string",title:"fs_size",default:""},discard:{type:"boolean",title:"discard",default:!1},bucket:{type:"string",title:"bucket",default:""}},required:["op","device","pool","label","fs_size","discard","bucket"]}}}),B(!0)},check_add_status:function(e){var t,n=(0,a.Z)(S);try{for(n.s();!(t=n.n()).done;){if(t.value.label.findIndex((function(t){return t.path==e.path}))>=0)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}})]})}},9569:function(e,t,n){n.r(t);var a=n(74165),r=n(15861),o=n(29439),s=n(47313),c=n(69099),i=n(71889),u=n(37982),l=n(89008),d=n(46417);t.default=function(e){var t=e.data;console.log("pool=",t);var n=(0,u.useData)(),f=n.global_data,p=n.api,h=(0,s.useState)([]),m=(0,o.Z)(h,2),g=m[0],v=m[1];(0,s.useEffect)((function(){v(e.data.label)}),[e.data]);var Z=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.run_command(i.default.device.evacuate({device:n.path,mount_path:t.mount_path}));case 2:if(0!=e.sent.ret){e.next=17;break}return e.next=6,p.run_command(i.default.device.remove({device:n.path,mount_path:t.mount_path}));case 6:if(0!=e.sent.ret){e.next=17;break}return(r=t.label.findIndex((function(e){return e.path==n.path})))>=0&&t.label.splice(r,1),o=f.get("pools"),(r=o.findIndex((function(e){return e.name===t.name})))>=0&&o.splice(r,1,t),e.next=15,p.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(o)});case 15:0==e.sent.ret&&(v(t.label),f.set("pools",o));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=(0,s.useState)({online:!1,status_text:"\u79bb\u7ebf"}),n=(0,o.Z)(e,2),u=n[0],l=n[1],f=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.mount_path,e.next=3,p.run_command(i.default.fs.usage(n));case 3:0==(r=e.sent).ret?(r.data.stdout.split("\n"),l({online:!0,status_text:"\u5728\u7ebf"})):l({online:!1,status_text:"\u79bb\u7ebf"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,p.run_command(i.default.mount(t));case 3:return e.sent,e.next=6,f();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,p.run_command(i.default.umount(t));case 3:return e.sent,e.next=6,f();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e=setInterval((function(){f()}),6e4);return f(),function(){clearInterval(e)}}),[]),(0,d.jsxs)("div",{children:["\u540d\u79f0:",t.name," \u6302\u8f7d\u4f4d\u7f6e: ",t.mount_path," \u72b6\u6001:",u.online&&(0,d.jsx)(c.Z,{onClick:m,children:"\u5378\u8f7d"}),!u.online&&(0,d.jsx)(c.Z,{onClick:h,children:"\u6302\u8f7d"})]})};return(0,d.jsxs)("div",{children:[(0,d.jsx)(x,{}),(0,d.jsx)(l.default,{data:g,onDown:function(e){console.log("down==",e)},onRemove:Z}),";"]})}},71889:function(e,t,n){n.r(t);var a=n(37762),r={command:"bcachefs",fs:{usage:function(e){var t=[];return t.push("fs"),t.push("usage"),t.push(e),{command:"bcachefs",args:t}}},device:{remove:function(e){var t=[];return t.push("device"),t.push("remove"),t.push(e.device),t.push(e.mount_path),{command:"bcachefs",args:t}},add:function(e){var t=[];return t.push("device"),t.push("add"),e.label&&""!=e.label&&t.push("--label=".concat(e.label)),e.fs_size&&""!=e.fs_size&&t.push("--fs_size=".concat(e.fs_size)),e.discard&&1==e.discard&&t.push("--discard"),e.bucket&&""!=e.bucket&&t.push("--bucket=".concat(e.bucket)),t.push(e.mount_path),t.push(e.device),{command:"bcachefs",args:t}},online:function(e){var t=[];return t.push("device"),t.push("online"),t.push(e.device),{command:"bcachefs",args:t}},offline:function(e){var t=[];return t.push("device"),t.push("offline"),t.push(e.device),{command:"bcachefs",args:t}},evacuate:function(e){var t=[];return t.push("device"),t.push("evacuate"),t.push(e.device),{command:"bcachefs",args:t}}},format:function(e){var t=[];t.push("format"),t.push("-f"),t.push("--compression=".concat(e.compression)),e.encrypted&&t.push("--encrypted"),t.push("--foreground_target=".concat(e.foreground_target)),t.push("--promote_target=".concat(e.promote_target)),t.push("--background_target=".concat(e.background_target)),t.push("--replicas=".concat(e.replicas));var n,r=(0,a.Z)(e.label);try{for(r.s();!(n=r.n()).done;){var o=n.value;t.push("--label=".concat(o.name)),t.push("".concat(o.path))}}catch(s){r.e(s)}finally{r.f()}return{command:this.command,args:t}},list:function(e){var t=[];return t.push("list"),t.push(e.path),{command:this.command,args:t}},list_journal:function(e){var t=[];return t.push("list_journal"),t.push(e.path),{command:this.command,args:t}},mount:function(e){var t=[];return t.push("-t"),t.push("bcachefs"),t.push(e.label.map((function(e){return e.path})).join(":")),t.push(e.mount_path),{command:"mount",args:t}},umount:function(e){var t=[];return t.push(e.mount_path),{command:"umount",args:t}}};t.default=r}}]);