"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[371,8,569,889],{89008:function(e,n,t){t.r(n);var a=t(37762),r=t(93433),o=t(1413),i=t(29439),s=t(47313),c=t(51629),u=t(70501),l=t(66835),d=t(23477),p=t(24076),f=t(67478),h=t(57861),m=t(69099),x=t(99783),g=t(37982),Z=t(46417);n.default=function(e){var n=(0,g.useData)(),t=n.global_data,v=(n.api,(0,s.useState)([])),_=(0,i.Z)(v,2),j=_[0],b=(_[1],(0,s.useState)(!0)),k=(0,i.Z)(b,2),y=(k[0],k[1],(0,s.useState)(0)),w=(0,i.Z)(y,2),C=w[0],S=w[1],D=(0,s.useState)(10),z=(0,i.Z)(D,2),O=z[0],A=z[1],I=(0,s.useState)({online:!1,status_text:"\u79bb\u7ebf"}),P=(0,i.Z)(I,2),E=(P[0],P[1],(0,s.useState)({data:[],disks:e.data||[]})),R=(0,i.Z)(E,2),L=R[0],N=R[1],q=function(e){N((function(n){return(0,o.Z)((0,o.Z)({},n),e)}))},F=(0,s.useState)(""),J=(0,i.Z)(F,2),M=J[0],W=(J[1],L.disks.filter((function(e){return Object.values(e).some((function(e){return e.toString().toLowerCase().includes(M.toLowerCase())}))})));return(0,s.useEffect)((function(){q({disks:e.data});t.get("blockdevices");var n=function(n){var i,s=t.get("blockdevices"),c=j,u=(0,r.Z)(L.disks),l=(0,a.Z)(e.data);try{var d=function(){var e=i.value,n=u.findIndex((function(n){return n.path==e.path}));n<0&&u.push(e)};for(l.s();!(i=l.n()).done;)d()}catch(f){l.e(f)}finally{l.f()}var p=n;c.forEach((function(e){var n=p.filter((function(n){return e.path=="/dev/".concat(n.Device)}))[0];if(s){var t=s.filter((function(n){return n.path===e.path}))[0];if(n&&t){var a=u.findIndex((function(n){return n.path==e.path}));a>=0?u.splice(a,1,(0,o.Z)((0,o.Z)({},t),{},{id:e.path},n)):u.push((0,o.Z)((0,o.Z)({},t),{},{id:e.path},n))}}})),q({disks:(0,r.Z)(u)})};return t.watch("sysstat",n),function(){t.unwatch("sysstat",n)}}),[e.data]),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(c.Z,{component:u.Z,children:(0,Z.jsxs)(l.Z,{children:[(0,Z.jsx)(d.Z,{children:(0,Z.jsxs)(p.Z,{children:[(0,Z.jsx)(f.Z,{children:"\u8bbe\u5907"}),(0,Z.jsx)(f.Z,{children:"PATH"}),(0,Z.jsx)(f.Z,{children:"\u6807\u8bc6"}),(0,Z.jsx)(f.Z,{children:"\u5bb9\u91cf"}),(0,Z.jsx)(f.Z,{children:"\u8bfb\u53d6"}),(0,Z.jsx)(f.Z,{children:"\u5199\u5165"})]})}),(0,Z.jsx)(h.Z,{children:W.slice(C*O,C*O+O).map((function(n){return(0,Z.jsxs)(p.Z,{children:[(0,Z.jsxs)(f.Z,{children:[e.onDown&&(0,Z.jsx)(m.Z,{onClick:function(){return e.onDown(n)},children:"\u4e0b\u7ebf"}),e.onAdd&&e.check_add_status&&e.check_add_status(n)&&(0,Z.jsx)(m.Z,{onClick:function(){return e.onAdd(n)},children:"\u6dfb\u52a0\u5230\u6c60"}),e.onRemove&&(0,Z.jsx)(m.Z,{onClick:function(){return e.onRemove(n)},children:"\u79fb\u9664"})]}),(0,Z.jsx)(f.Z,{children:n.path}),(0,Z.jsxs)(f.Z,{children:[n.model," ",n.serial," ",n.size]}),(0,Z.jsx)(f.Z,{children:n.size}),(0,Z.jsx)(f.Z,{children:n["kB_read/s"]}),(0,Z.jsx)(f.Z,{children:n["kB_wrtn/s"]})]},n.path)}))})]})}),(0,Z.jsx)(x.Z,{component:"div",count:W.length,page:C,onPageChange:function(e,n){S(n)},rowsPerPage:O,onRowsPerPageChange:function(e){A(parseInt(e.target.value,10)),S(0)},style:{marginTop:"1rem"}})]})}},9569:function(e,n,t){t.r(n);var a=t(74165),r=t(15861),o=t(29439),i=t(47313),s=t(69099),c=t(71889),u=t(37982),l=t(89008),d=t(46417);n.default=function(e){var n=e.data;console.log("pool=",n);var t=(0,u.useData)(),p=t.global_data,f=t.api,h=(0,i.useState)([]),m=(0,o.Z)(h,2),x=m[0],g=m[1];(0,i.useEffect)((function(){g(e.data.label)}),[e.data]);var Z=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.run_command(c.default.device.evacuate({device:t.path,mount_path:n.mount_path}));case 2:if(0!=e.sent.ret){e.next=17;break}return e.next=6,f.run_command(c.default.device.remove({device:t.path,mount_path:n.mount_path}));case 6:if(0!=e.sent.ret){e.next=17;break}return(r=n.label.findIndex((function(e){return e.path==t.path})))>=0&&n.label.splice(r,1),o=p.get("pools"),(r=o.findIndex((function(e){return e.name===n.name})))>=0&&o.splice(r,1,n),e.next=15,f.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(o)});case 15:0==e.sent.ret&&(g(n.label),p.set("pools",o));case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),v=function(){var e=(0,i.useState)({online:!1,status_text:"\u79bb\u7ebf"}),t=(0,o.Z)(e,2),u=t[0],l=t[1],p=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.mount_path,e.next=3,f.run_command(c.default.fs.usage(t));case 3:0==(r=e.sent).ret?(r.data.stdout.split("\n"),l({online:!0,status_text:"\u5728\u7ebf"})):l({online:!1,status_text:"\u79bb\u7ebf"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,f.run_command(c.default.mount(n));case 3:return e.sent,e.next=6,p();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),m=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,f.run_command(c.default.umount(n));case 3:return e.sent,e.next=6,p();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,i.useEffect)((function(){var e=setInterval((function(){p()}),6e4);return p(),function(){clearInterval(e)}}),[]),(0,d.jsxs)("div",{children:["\u540d\u79f0:",n.name," \u6302\u8f7d\u4f4d\u7f6e: ",n.mount_path," \u72b6\u6001:",u.online&&(0,d.jsx)(s.Z,{onClick:m,children:"\u5378\u8f7d"}),!u.online&&(0,d.jsx)(s.Z,{onClick:h,children:"\u6302\u8f7d"})]})};return(0,d.jsxs)("div",{children:[(0,d.jsx)(v,{}),(0,d.jsx)(l.default,{data:x,onDown:function(e){console.log("down==",e)},onRemove:Z}),";"]})}},59371:function(e,n,t){t.r(n);var a=t(37762),r=t(74165),o=t(15861),i=t(29439),s=t(1413),c=t(47313),u=t(96467),l=t(75908),d=t(66149),p=t(33604),f=t(4117),h=t(69099),m=t(97762),x=t(9289),g=t(47131),Z=t(61113),v=t(10437),_=t(33947),j=t(19536),b=t(48310),k=t(20527),y=t(74748),w=t(83213),C=t(10724),S=t(95644),D=t(24272),z=t(96944),O=t(36555),A=t(8586),I=t(84062),P=t(79274),E=t(27474),R=t(37982),L=t(89008),N=t(9569),q=t(46817),F=t(71889),J=t(46417),M=240,W=(0,C.Z)(u.Z)({width:"80%"}),B=(0,C.Z)("main",{shouldForwardProp:function(e){return"open"!==e}})((function(e){var n=e.theme,t=e.open;return(0,s.Z)({flexGrow:1,padding:n.spacing(3),transition:n.transitions.create("margin",{easing:n.transitions.easing.sharp,duration:n.transitions.duration.leavingScreen}),marginLeft:"-".concat(M,"px")},t&&{transition:n.transitions.create("margin",{easing:n.transitions.easing.easeOut,duration:n.transitions.duration.enteringScreen}),marginLeft:0})})),T=(0,C.Z)(l.Z,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var n=e.theme,t=e.open;return(0,s.Z)({transition:n.transitions.create(["margin","width"],{easing:n.transitions.easing.sharp,duration:n.transitions.duration.leavingScreen})},t&&{width:"calc(100% - ".concat(M,"px)"),marginLeft:"".concat(M,"px"),transition:n.transitions.create(["margin","width"],{easing:n.transitions.easing.easeOut,duration:n.transitions.duration.enteringScreen})})})),$=(0,C.Z)("div")((function(e){var n=e.theme;return(0,s.Z)((0,s.Z)({display:"flex",alignItems:"center",padding:n.spacing(0,1)},n.mixins.toolbar),{},{justifyContent:"flex-end"})}));n.default=function(e){var n=(0,R.useData)(),t=n.global_data,l=n.api,C=(0,c.useState)({disks:[],pools:[],drawOpen:!1,all_disk:!0,show_pools:!1,openAddDialog:!1,schema:{},data:{id:0,key:"",status:0,type:0,value:"",parent_id:0}}),G=(0,i.Z)(C,2),H=G[0],V=G[1],K=e.onActive,Q=e.onClose,U=e.onRestore,X=e.onMaximize,Y=e.onMinimize,ee=function(e){V((function(n){return(0,s.Z)((0,s.Z)({},n),e)}))};(0,c.useEffect)((function(){var e=function(e){ee({pools:e})},n=function(e){console.log("my_set====",e),ee({disks:e})},a=t.get("pools",[],(0,o.Z)((0,r.Z)().mark((function e(){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.config_file({filename:"config/pools.config",op:"get"});case 2:0==(n=e.sent).ret&&(a=JSON.parse(n.data),t.set("pools",a));case 4:case"end":return e.stop()}}),e)}))));return ee({pools:a}),l.disk_info({}),t.watch("blockdevices",n),t.watch("pools",e),function(){t.unwatch("blockdevices",n),t.unwatch("pools",e)}}),[]);var ne=function(){var e,n=[],t=(0,a.Z)(H.pools);try{for(t.s();!(e=t.n()).done;){var r=e.value;n.push((0,J.jsx)(N.default,{data:r},r))}}catch(o){t.e(o)}finally{t.f()}return n},te=(0,c.useRef)(null),ae=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){var n,a,o,i,c,u,d,p,f,h,m;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=te.current.getValue(),a=H.pools,e.t0=n.op,e.next="add_device_to_pool"===e.t0?6:"addpool"===e.t0?21:45;break;case 6:return console.log("add device to pool",n),o=a.findIndex((function(e){return e.name==n.pool})),i=null,o>=0&&(i=a[o]),e.next=12,l.run_command((0,s.Z)({},F.default.device.add((0,s.Z)((0,s.Z)({},n),{},{mount_path:i.mount_path}))));case 12:if(0!=e.sent.ret){e.next=20;break}return(c=i.label.findIndex((function(e){return e.path==n.device})))>=0?i.label.splice(c,1,(0,s.Z)((0,s.Z)({},i.label[c]),{},{name:n.label,path:n.device})):i.label.push({name:n.label,path:n.device}),e.next=18,l.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(a)});case 18:0==e.sent.ret&&(t.set("pools",a),ee({openAddDialog:!1}));case 20:return e.abrupt("break",45);case 21:return e.next=23,l.run_command((0,s.Z)((0,s.Z)({},F.default.format(n)),{},{config:n}));case 23:if(u=e.sent,console.log("format_ret===",u),0!=u.ret){e.next=43;break}return d=n.name,(f=(p=a).findIndex((function(e){return e.name==d})))>=0?p.split(f,1,n):p.push(n),t.set("pools",p),e.next=33,l.config_file({op:"put",filename:"config/pools.config",data:JSON.stringify(p)});case 33:if(0==(h=e.sent).ret&&console.log("write_config ok=",h),1!=n.auto_mount){e.next=40;break}return e.next=38,l.run_command((0,s.Z)((0,s.Z)({},F.default.mount(n)),{},{config:n}));case 38:m=e.sent,console.log("mount_ret===",m);case 40:ee({openAddDialog:!1}),e.next=44;break;case 43:t.set("alerts",[{id:"error",content:(0,J.jsx)(oe,{title:"\u9519\u8bef",content:u.stderr})}]);case 44:return e.abrupt("break",45);case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(0),console.error("Error saving parameter:",e.t1);case 50:case"end":return e.stop()}}),e,null,[[0,47]])})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=function(){ee({openAddDialog:!H.openAddDialog})};return(0,J.jsxs)(d.Z,{open:H.openAddDialog,onClose:e,fullWidth:!0,maxWidth:"md",children:[(0,J.jsx)(p.Z,{children:"\u6dfb\u52a0\u53c2\u6570"}),(0,J.jsx)(W,{children:(0,J.jsx)(q.default,{schema:H.schema,ref:te})}),(0,J.jsxs)(f.Z,{children:[(0,J.jsx)(h.Z,{onClick:ae,children:"\u4fdd\u5b58"}),(0,J.jsx)(h.Z,{onClick:e,children:"\u53d6\u6d88"})]})]})},oe=function(e){var n=function(){t.set("alerts",[])};return(0,J.jsxs)(d.Z,{open:!0,onClose:n,fullWidth:!0,maxWidth:"md",children:[(0,J.jsx)(p.Z,{children:e.title}),(0,J.jsx)(u.Z,{children:(0,J.jsx)(m.Z,{children:e.content})}),(0,J.jsx)(f.Z,{children:(0,J.jsx)(h.Z,{onClick:n,children:"\u5173\u95ed"})})]})};return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(T,{open:H.drawOpen,sx:{position:"relative"},children:(0,J.jsxs)(x.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,J.jsx)(g.Z,{edge:"start",color:"inherit",onClick:function(){ee({drawOpen:!H.drawOpen})},sx:(0,s.Z)({mr:2},H.drawOpen&&{display:"none"}),children:(0,J.jsx)(S.Z,{})}),(0,J.jsx)(Z.Z,{variant:"h6",component:"div",sx:{flexGrow:1,cursor:"move"},className:"window-title",onClick:K,children:"\u5b58\u50a8\u8bbe\u7f6e"}),(0,J.jsx)(g.Z,{color:"inherit",onClick:Y,children:(0,J.jsx)(D.Z,{})}),e.isMaximized?(0,J.jsx)(g.Z,{color:"inherit",onClick:U,children:(0,J.jsx)(z.Z,{})}):(0,J.jsx)(g.Z,{color:"inherit",onClick:X,children:(0,J.jsx)(O.Z,{})}),(0,J.jsx)(g.Z,{color:"inherit",onClick:Q,children:(0,J.jsx)(A.Z,{})})]})}),(0,J.jsxs)(v.Z,{p:2,sx:{display:"flex"},children:[(0,J.jsxs)(_.ZP,{anchor:"left",open:H.drawOpen,onClose:function(){},sx:{width:M,flexShrink:0,"& .MuiDrawer-paper":{width:M,boxSizing:"border-box"}},variant:"persistent",children:[(0,J.jsx)($,{children:(0,J.jsx)(g.Z,{onClick:function(){ee({drawOpen:!H.drawOpen})},children:(0,J.jsx)(I.Z,{})})}),(0,J.jsx)(j.Z,{}),(0,J.jsxs)(b.Z,{children:[(0,J.jsxs)(k.ZP,{button:!0,onClick:function(){ee({all_disk:!0,show_pools:!1})},children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(P.Z,{})}),(0,J.jsx)(w.Z,{primary:"\u6240\u6709\u78c1\u76d8"})]}),(0,J.jsxs)(k.ZP,{button:!0,onClick:function(){ee({all_disk:!1,show_pools:!0})},children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(E.Z,{})}),(0,J.jsx)(w.Z,{primary:"\u5b58\u50a8\u6c60"})]}),(0,J.jsxs)(k.ZP,{button:!0,onClick:function(e){e.preventDefault(),ee({openAddDialog:!0,schema:{$ref:"#/definitions/bcachefs_config",definitions:{bcachefs_label:{type:"array",title:"\u6807\u7b7e\u914d\u7f6e",uniqueItems:!0,items:{type:"object",headerTemplate:"{{self.name}}={{self.path}}",properties:{name:{type:"string",default:"",title:"label_name"},path:{type:"string",format:"disk_select",title:"\u8bbe\u5907"},model:{type:"string",title:"\u786c\u76d8",options:{hidden:!0}}},required:["name","path","model"]}},bcachefs_config:{type:"object",properties:{op:{type:"string",default:"addpool",options:{hidden:!0}},name:{type:"string",title:"\u540d\u79f0",default:"pool"},compression:{type:"string",title:"\u538b\u7f29\u65b9\u5f0f",enum:["none","lz4","gzip","zstd"],default:"none",options:{enum_titles:["none","lz4","gzip","zstd"]}},encrypted:{type:"boolean",title:"\u52a0\u5bc6",default:!1},replicas:{type:"integer",title:"\u6570\u636e\u526f\u672c\u6570\u91cf",default:1},foreground_target:{type:"string",title:"\u524d\u7aef\u8bbe\u5907\u6807\u7b7e",default:""},promote_target:{type:"string",title:"promote_target\u8bbe\u5907\u6807\u7b7e",default:""},background_target:{type:"string",title:"\u540e\u7aef\u8bbe\u5907\u6807\u7b7e",default:""},label:{title:"\u5b58\u50a8\u6807\u7b7e\u8bbe\u7f6e",$ref:"#/definitions/bcachefs_label"},auto_mount:{type:"boolean",title:"\u81ea\u52a8\u6302\u8f7d",default:!1},mount_path:{type:"string",title:"\u6302\u8f7d\u8def\u5f84",default:"/mnt"}},required:["op","name","compression","encrypted","replicas","foreground_target","promote_target","background_target","label","auto_mount","mount_path"]}}}})},children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(E.Z,{})}),(0,J.jsx)(w.Z,{primary:"\u6dfb\u52a0\u6c60"})]})]})]}),(0,J.jsxs)(B,{open:H.drawOpen,children:[H.show_pools&&(0,J.jsx)(ne,{}),H.all_disk&&(0,J.jsx)(L.default,{data:H.disks,onAdd:function(e){var n=H.pools.map((function(e){return e.name}));ee({openAddDialog:!0,schema:{$ref:"#/definitions/config",definitions:{config:{type:"object",title:"\u52a0\u5165\u5230\u6c60",properties:{op:{type:"string",default:"add_device_to_pool",options:{hidden:!0}},device:{type:"string",default:e.path,options:{hidden:!0}},pool:{type:"string",title:"\u6c60\u540d\u5b57",enum:n,options:{enum_titles:n}},label:{type:"string",title:"\u6807\u7b7e",default:""},fs_size:{type:"string",title:"fs_size",default:""},discard:{type:"boolean",title:"discard",default:!1},bucket:{type:"string",title:"bucket",default:""}},required:["op","device","pool","label","fs_size","discard","bucket"]}}}})},check_add_status:function(e){var n,t=(0,a.Z)(H.pools);try{for(t.s();!(n=t.n()).done;){if(n.value.label.findIndex((function(n){return n.path==e.path}))>=0)return!1}}catch(r){t.e(r)}finally{t.f()}return!0}}),H.openAddDialog&&(0,J.jsx)(re,{})]})]})]})}},71889:function(e,n,t){t.r(n);var a=t(37762),r={command:"bcachefs",fs:{usage:function(e){var n=[];return n.push("fs"),n.push("usage"),n.push(e),{command:"bcachefs",args:n}}},device:{remove:function(e){var n=[];return n.push("device"),n.push("remove"),n.push(e.device),n.push(e.mount_path),{command:"bcachefs",args:n}},add:function(e){var n=[];return n.push("device"),n.push("add"),e.label&&""!=e.label&&n.push("--label=".concat(e.label)),e.fs_size&&""!=e.fs_size&&n.push("--fs_size=".concat(e.fs_size)),e.discard&&1==e.discard&&n.push("--discard"),e.bucket&&""!=e.bucket&&n.push("--bucket=".concat(e.bucket)),n.push(e.mount_path),n.push(e.device),{command:"bcachefs",args:n}},online:function(e){var n=[];return n.push("device"),n.push("online"),n.push(e.device),{command:"bcachefs",args:n}},offline:function(e){var n=[];return n.push("device"),n.push("offline"),n.push(e.device),{command:"bcachefs",args:n}},evacuate:function(e){var n=[];return n.push("device"),n.push("evacuate"),n.push(e.device),{command:"bcachefs",args:n}}},format:function(e){var n=[];n.push("format"),n.push("-f"),n.push("--compression=".concat(e.compression)),e.encrypted&&n.push("--encrypted"),n.push("--foreground_target=".concat(e.foreground_target)),n.push("--promote_target=".concat(e.promote_target)),n.push("--background_target=".concat(e.background_target)),n.push("--replicas=".concat(e.replicas));var t,r=(0,a.Z)(e.label);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push("--label=".concat(o.name)),n.push("".concat(o.path))}}catch(i){r.e(i)}finally{r.f()}return{command:this.command,args:n}},list:function(e){var n=[];return n.push("list"),n.push(e.path),{command:this.command,args:n}},list_journal:function(e){var n=[];return n.push("list_journal"),n.push(e.path),{command:this.command,args:n}},mount:function(e){var n=[];return n.push("-t"),n.push("bcachefs"),n.push(e.label.map((function(e){return e.path})).join(":")),n.push(e.mount_path),{command:"mount",args:n}},umount:function(e){var n=[];return n.push(e.mount_path),{command:"umount",args:n}}};n.default=r}}]);