"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[583,905,149],{7905:function(e,n,t){t.r(n);var a=t(42982),r=t(1413),c=t(70885),s=t(72791),u=t(39281),o=t(35527),i=t(79836),d=t(56890),h=t(35855),l=t(53994),p=t(53382),f=t(36151),m=t(89341),v=t(28714),x=t(80184);n.default=function(e){var n=(0,s.useState)([]),t=(0,c.Z)(n,2),Z=t[0],g=t[1],_=(0,s.useState)([]),b=(0,c.Z)(_,2),j=b[0],k=b[1],w=(0,s.useState)(!0),y=(0,c.Z)(w,2),C=(y[0],y[1],(0,s.useState)(0)),S=(0,c.Z)(C,2),D=S[0],z=S[1],I=(0,s.useState)(10),P=(0,c.Z)(I,2),E=P[0],R=P[1],A=(0,s.useState)({online:!1,status_text:"\u79bb\u7ebf"}),B=(0,c.Z)(A,2),L=(B[0],B[1],(0,s.useState)("")),O=(0,c.Z)(L,2),T=O[0],F=(O[1],Z.filter((function(e){return Object.values(e).some((function(e){return e.toString().toLowerCase().includes(T.toLowerCase())}))}))),H=(0,v.useData)(),J=H.global_data;return H.api,(0,s.useEffect)((function(){J.get("blockdevices");var e=function(e){var n=J.get("blockdevices"),t=Z,c=e;j.forEach((function(e){var a=c.filter((function(n){return e.path=="/dev/".concat(n.Device)}))[0];if(n){var s=n.filter((function(n){return n.path===e.path}))[0];if(a&&s){var u=t.findIndex((function(n){return n.path==e.path}));u>=0?t.splice(u,1,(0,r.Z)((0,r.Z)({},s),{},{id:e.path},a)):t.push((0,r.Z)((0,r.Z)({},s),{},{id:e.path},a))}}})),g((0,a.Z)(t))};return J.watch("sysstat",e),g(j),function(){J.unwatch("sysstat",e)}}),[j]),(0,s.useEffect)((function(){console.log("props===",e),e.data&&k(e.data)}),[e.data]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(u.Z,{component:o.Z,children:(0,x.jsxs)(i.Z,{children:[(0,x.jsx)(d.Z,{children:(0,x.jsxs)(h.Z,{children:[(0,x.jsx)(l.Z,{children:"\u8bbe\u5907"}),(0,x.jsx)(l.Z,{children:"PATH"}),(0,x.jsx)(l.Z,{children:"\u6807\u8bc6"}),(0,x.jsx)(l.Z,{children:"\u5bb9\u91cf"}),(0,x.jsx)(l.Z,{children:"\u8bfb\u53d6"}),(0,x.jsx)(l.Z,{children:"\u5199\u5165"})]})}),(0,x.jsx)(p.Z,{children:F.slice(D*E,D*E+E).map((function(n){return(0,x.jsxs)(h.Z,{children:[(0,x.jsxs)(l.Z,{children:[e.onDown&&(0,x.jsx)(f.Z,{onClick:function(){return e.onDown(n)},children:"\u4e0b\u7ebf"}),e.onAdd&&e.check_add_status&&e.check_add_status(n)&&(0,x.jsx)(f.Z,{onClick:function(){return e.onAdd(n)},children:"\u6dfb\u52a0\u5230\u6c60"}),e.onRemove&&(0,x.jsx)(f.Z,{onClick:function(){return e.onRemove(n)},children:"\u79fb\u9664"})]}),(0,x.jsx)(l.Z,{children:n.path}),(0,x.jsxs)(l.Z,{children:[n.model," ",n.serial," ",n.size]}),(0,x.jsx)(l.Z,{children:n.size}),(0,x.jsx)(l.Z,{children:n["kB_read/s"]}),(0,x.jsx)(l.Z,{children:n["kB_wrtn/s"]})]},n.path)}))})]})}),(0,x.jsx)(m.Z,{component:"div",count:F.length,page:D,onPageChange:function(e,n){z(n)},rowsPerPage:E,onRowsPerPageChange:function(e){R(parseInt(e.target.value,10)),z(0)},style:{marginTop:"1rem"}})]})}},70583:function(e,n,t){t.r(n);var a=t(74165),r=t(15861),c=t(70885),s=t(72791),u=t(36151),o=t(76149),i=t(28714),d=t(7905),h=t(80184);n.default=function(e){var n=e.data;console.log("pool=",n);var t=(0,i.useData)(),l=t.global_data,p=t.api,f=(0,s.useState)([]),m=(0,c.Z)(f,2),v=m[0],x=m[1];(0,s.useEffect)((function(){x(e.data.label)}),[e.data]);var Z=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var r,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.run_command(o.default.device.evacuate({device:t.path,mount_path:n.mount_path}));case 2:if(0!=e.sent.ret){e.next=17;break}return e.next=6,p.run_command(o.default.device.remove({device:t.path,mount_path:n.mount_path}));case 6:if(0!=e.sent.ret){e.next=17;break}return(r=n.label.findIndex((function(e){return e.path==t.path})))>=0&&n.label.splice(r,1),c=l.get("pools"),(r=c.findIndex((function(e){return e.name===n.name})))>=0&&c.splice(r,1,n),e.next=15,p.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(c)});case 15:0==e.sent.ret&&(x(n.label),l.set("pools",c));case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),g=function(){var e=(0,s.useState)({online:!1,status_text:"\u79bb\u7ebf"}),t=(0,c.Z)(e,2),i=t[0],d=t[1],l=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.mount_path,e.next=3,p.run_command(o.default.fs.usage(t));case 3:0==(r=e.sent).ret?(r.data.stdout.split("\n"),d({online:!0,status_text:"\u5728\u7ebf"})):d({online:!1,status_text:"\u79bb\u7ebf"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,p.run_command(o.default.mount(n));case 3:return e.sent,e.next=6,l();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),m=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,p.run_command(o.default.umount(n));case 3:return e.sent,e.next=6,l();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e=setInterval((function(){l()}),6e4);return l(),function(){clearInterval(e)}}),[]),(0,h.jsxs)("div",{children:["\u540d\u79f0:",n.name," \u6302\u8f7d\u4f4d\u7f6e: ",n.mount_path," \u72b6\u6001:",i.online&&(0,h.jsx)(u.Z,{onClick:m,children:"\u5378\u8f7d"}),!i.online&&(0,h.jsx)(u.Z,{onClick:f,children:"\u6302\u8f7d"})]})};return(0,h.jsxs)("div",{children:[(0,h.jsx)(g,{}),(0,h.jsx)(d.default,{data:v,onDown:function(e){console.log("down==",e)},onRemove:Z}),";"]})}},76149:function(e,n,t){t.r(n);var a=t(37762),r={command:"bcachefs",fs:{usage:function(e){var n=[];return n.push("fs"),n.push("usage"),n.push(e),{command:"bcachefs",args:n}}},device:{remove:function(e){var n=[];return n.push("device"),n.push("remove"),n.push(e.device),n.push(e.mount_path),{command:"bcachefs",args:n}},add:function(e){var n=[];return n.push("device"),n.push("add"),e.label&&""!=e.label&&n.push("--label=".concat(e.label)),e.fs_size&&""!=e.fs_size&&n.push("--fs_size=".concat(e.fs_size)),e.discard&&1==e.discard&&n.push("--discard"),e.bucket&&""!=e.bucket&&n.push("--bucket=".concat(e.bucket)),n.push(e.mount_path),n.push(e.device),{command:"bcachefs",args:n}},online:function(e){var n=[];return n.push("device"),n.push("online"),n.push(e.device),{command:"bcachefs",args:n}},offline:function(e){var n=[];return n.push("device"),n.push("offline"),n.push(e.device),{command:"bcachefs",args:n}},evacuate:function(e){var n=[];return n.push("device"),n.push("evacuate"),n.push(e.device),{command:"bcachefs",args:n}}},format:function(e){var n=[];n.push("format"),n.push("--compression=".concat(e.compression)),e.encrypted&&n.push("--encrypted"),n.push("--foreground_target=".concat(e.foreground_target)),n.push("--promote_target=".concat(e.promote_target)),n.push("--background_target=".concat(e.background_target)),n.push("--replicas=".concat(e.replicas));var t,r=(0,a.Z)(e.label);try{for(r.s();!(t=r.n()).done;){var c=t.value;n.push("--label=".concat(c.name)),n.push("".concat(c.path))}}catch(s){r.e(s)}finally{r.f()}return{command:this.command,args:n}},list:function(e){var n=[];return n.push("list"),n.push(e.path),{command:this.command,args:n}},list_journal:function(e){var n=[];return n.push("list_journal"),n.push(e.path),{command:this.command,args:n}},mount:function(e){var n=[];return n.push("-t"),n.push("bcachefs"),n.push(e.label.map((function(e){return e.path})).join(":")),n.push(e.mount_path),{command:"mount",args:n}},umount:function(e){var n=[];return n.push(e.mount_path),{command:"umount",args:n}}};n.default=r}}]);
//# sourceMappingURL=583.370cd97a.chunk.js.map