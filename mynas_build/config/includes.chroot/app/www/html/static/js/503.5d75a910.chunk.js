"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[503],{65503:function(e,t,n){n.r(t);var r=n(1413),s=n(29439),a=n(74165),c=n(15861),i=n(47313),o=(n(60786),n(60270),n(147),n(66641),n(69393)),u=n(65489),l=n(63469),d=(n(66109),n(24931)),f=n(37982),p=n(46417),v=(0,i.forwardRef)((function(e,t){var n=i.createRef(),v=(0,o.useWindowManager)(),h=(v.windows,v.getApps,v.openWindow,v.set_window_ref,v.openDialog),_=(v.closeDialog,(0,f.useData)()),w=_.global_data,m=_.api,g=(0,f.rix_make_watch_data)({step:w.get("vm_service","check",(function(){d.default.check_virt_manager()})),networks:[]}),x=function(){var e=(0,c.Z)((0,a.Z)().mark((function e(){var t,n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.default.check_virt_manager();case 2:return!1,!1,e.next=6,m.run_command({command:"/bin/bash",args:["./scripts/get_ip.sh"]});case 6:0==(t=e.sent).ret&&(n=[],t.data.stdout.split("\n").forEach((function(e){try{console.log("v===",e),n.push(JSON.parse(e))}catch(t){}})),r=n.map((function(e){return e.ipv4=e.ipv4.split("\n"),e.ipv6=e.ipv6.split("\n"),e})),g.set("networks",r),"run"==w.vm_service&&g.set("step","connect"));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){x();w.watch("vm_service",(function(){console.log("vm_service update===",w),"run"!=w.vm_service?g.set("step",w.vm_service):g.networks.length>0&&g.set("step","connect")}));return function(){w.unwatch("vm_service")}}));var k=function(){var e=(0,i.useState)(0),t=(0,s.Z)(e,2),n=t[0],r=t[1],a=g.step;(0,i.useEffect)((function(){var e=g.watch("step",(function(){r(n+1)}));return function(){g.unwatch("step",e)}}));switch(a){case"not_installed":return(0,p.jsxs)("div",{children:["\u672a\u5b89\u88c5\u7ba1\u7406\u5668\uff0c\u7acb\u523b\u5b89\u88c5?",(0,p.jsx)(l.default,{className:"button success",onClick:function(){var e="dialog_"+Date.now();h({id:e,content:(0,p.jsx)(d.default.InstallVM_Manager,{id:e})})},children:"\u5b89\u88c5"})]});case"stop":return(0,p.jsxs)("div",{children:["\u7ba1\u7406\u5668\u672a\u8fd0\u884c\uff0c\u7acb\u523b\u542f\u52a8",(0,p.jsx)(l.default,{className:"button success",onClick:function(){var e="dialog_"+Date.now();h({id:e,content:(0,p.jsx)(d.default.StartVM_Manager,{id:e})})},children:"\u542f\u52a8"})]});case"connect":var c="http://".concat(g.networks[0].ipv4[0],":8185");return(0,p.jsx)("iframe",{src:c,style:{width:"100%",height:"100%"},frameborder:"0",scrolling:"no"});default:return(0,p.jsx)("div",{children:a})}};return(0,p.jsx)(u.default,(0,r.Z)((0,r.Z)({},e),{},{ref:t,children:(0,p.jsx)("div",{style:{height:"100%",overflow:"hidden"},ref:n,children:(0,p.jsx)(k,{})})}))}));t.default=v}}]);