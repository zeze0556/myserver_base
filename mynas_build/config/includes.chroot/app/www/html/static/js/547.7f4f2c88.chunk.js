"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[547],{71547:function(t,n,e){e.r(n);var c=e(29439),s=e(1413),i=e(74165),o=e(15861),a=e(47313),r=e(69393),u=e(63469),f=e(63705),l=(e(47610),e(86385),e(56659),e(84724)),p=e(37982),d=(e(66109),e(94536),e(46817)),g=(e(60786),e(66641),e(60270),e(147),e(70816)),h=e.n(g),m=e(56573),w=e(46417),x=(p.context_value.global_data,p.context_value.api),v={config:(0,p.context_value.make_watch_data)({config:{}}),get_config:function(){return(0,o.Z)((0,i.Z)().mark((function t(){var n;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x.config_file({filename:"/app/config.json",op:"get"});case 3:return n=t.sent,v.config.set("config",n),console.log("set config====",n,v.config),t.abrupt("return",n);case 9:return t.prev=9,t.t0=t.catch(0),console.log("error===",t.t0),t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},save_config:function(t){return(0,o.Z)((0,i.Z)().mark((function n(){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.config_file({op:"put",filename:"/app/config.json",data:JSON.stringify(t,null,2)});case 2:return n.next=4,v.get_config();case 4:case"end":return n.stop()}}),n)})))()},test_mail:function(){return(0,o.Z)((0,i.Z)().mark((function t(){var n;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.Z.post("/api/notify",{subject:"this is  for test notify from web at ".concat(h()()),message:"test in system control \u8fd9\u4e2a\u662f\u4e2d\u6587\u4ee5\u53ca\u8868\u60c5\u7b26\u53f7 \ud83c\udf39",attach:"/app/test.sh"});case 2:n=t.sent,console.log("send_ret==",n);case 4:case"end":return t.stop()}}),t)})))()},edit_auto_start:function(){return(0,o.Z)((0,i.Z)().mark((function t(){var n,e,c,o,u,p;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="/app/scripts/auto_start.sh",t.next=3,x.config_file({filename:n,op:"get"});case 3:e=t.sent,r.WindowApi.windows,r.WindowApi.getApps,r.WindowApi.openWindow,r.WindowApi.set_window_ref,c=r.WindowApi.openDialog,o=r.WindowApi.closeDialog,u="dialog_"+Date.now(),p=function(t){var c=(0,a.useRef)(null),i=(0,s.Z)((0,s.Z)({},l.default),{},{$ref:"#/definitions/sh_script"});return(0,w.jsxs)(f.default,{className:"w-100",id:t.id,children:[(0,w.jsx)("div",{type:"title",children:"\u81ea\u52a8\u542f\u52a8\u914d\u7f6e"}),(0,w.jsx)("div",{type:"content",className:"w-100",children:(0,w.jsx)(d.default,{schema:i,ref:c,data:e})}),(0,w.jsx)("button",{type:"action",className:"button success",onClick:function(){var t=c.current.getValue();x.config_file({filename:n,op:"put",data:t}),o(u)},children:" \u4fdd\u5b58 "}),(0,w.jsx)("button",{type:"action",className:"button js-dialog-close",children:" \u5173\u95ed "})]})},c({id:u,content:(0,w.jsx)(p,{id:u})});case 8:case"end":return t.stop()}}),t)})))()},Setting:function(t){var n=(0,a.useState)(0),e=(0,c.Z)(n,2),r=e[0],f=e[1];(0,a.useEffect)((function(){var t=v.config.watch("config",(function(){console.log("config update!!!!"),f(r+1)}));return function(){v.config.unwatch("config",t)}}));var p=(0,s.Z)((0,s.Z)({},l.default),{},{$ref:"#/definitions/system_settings"}),g=v.config.config;console.log("system.config==",v.config);var h=(0,a.useRef)(null),m=function(){var t=(0,o.Z)((0,i.Z)().mark((function t(){var n;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=h.current.getValue(),v.save_config(n);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),x=function(){var t=(0,o.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:v.test_mail();case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,w.jsxs)("div",{className:"w-100 h-100",children:[(0,w.jsx)("div",{type:"content",children:(0,w.jsx)(d.default,{schema:p,ref:h,data:g})}),(0,w.jsx)(u.default,{type:"action",className:"button success",onClick:x,children:"\u6d4b\u8bd5\u901a\u77e5"}),(0,w.jsx)(u.default,{type:"action",className:"button success",onClick:m,children:"\u4fdd\u5b58"}),(0,w.jsx)(u.default,{type:"action",className:"button success",onClick:function(){v.edit_auto_start()},children:"\u7f16\u8f91\u81ea\u52a8\u542f\u52a8\u811a\u672c"}),(0,w.jsx)("button",{type:"action",className:"button js-dialog-close",children:"\u5173\u95ed"})]})},Render:function(t){return v.get_config(),(0,w.jsx)(v.Setting,(0,s.Z)({},t))}};n.default=v}}]);