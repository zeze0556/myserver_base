"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[380,118,806],{55113:function(n,e,t){t.r(e);var r=t(72791),o=t(84395),i=t(34663),a=t(20890),s=t(13400),c=t(54982),u=t(45675),l=t(52118),d=t(96739),f=(t(28714),t(80184)),p=(0,r.forwardRef)((function(n,e){var t=n.onActive,r=n.onClose,p=n.onRestore,h=n.onMaximize,m=n.onMinimize;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.Z,{sx:{position:"relative"},children:(0,f.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"8px"},children:[(0,f.jsx)(a.Z,{variant:"h6",component:"div",sx:{flexGrow:1,cursor:"move"},className:"window-title",onClick:t,children:n.title}),(0,f.jsx)(s.Z,{color:"inherit",onClick:m,children:(0,f.jsx)(c.Z,{})}),n.isMaximized?(0,f.jsx)(s.Z,{color:"inherit",onClick:p,children:(0,f.jsx)(u.Z,{})}):(0,f.jsx)(s.Z,{color:"inherit",onClick:h,children:(0,f.jsx)(l.Z,{})}),(0,f.jsx)(s.Z,{color:"inherit",onClick:r,children:(0,f.jsx)(d.Z,{})})]})}),n.children]})}));e.default=p},19115:function(n,e,t){t.r(e),t.d(e,{default:function(){return N}});var r=t(74165),o=t(15861),i=t(1413),a=t(70885),s=t(72791),c=t(95806),u=t(16118),l=t(32699),d=(t(86142),t(83531)),f=(t(56320),t(28714)),p=t(99059),h=t(98530),m=t(39281),Z=t(35527),v=t(79836),g=t(56890),x=t(35855),k=t(53994),w=t(53382),_=t(36151),j=t(89341),b=t(39157),y=t(5289),S=t(65661),C=t(97123),R=t(19727),E=t(55113),I=t(80184);function V(n){var e=(0,s.useRef)(null),t=(0,s.useRef)(null),r=(0,s.useState)(""),o=(0,a.Z)(r,2);o[0],o[1];return(0,s.useEffect)((function(){e.current=new l.Terminal({rows:40,convertEol:!0,scrollback:10,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0});var r=new d.FitAddon;e.current.loadAddon(r),e.current.onResize((function(n){r.fit()})),e.current.open(t.current),null!=n.data&&c.default[n.data.op](n.data,{stdout:function(n){console.log("up_container=",n),e.current&&e.current.write(n)},stderr:function(n){console.log("up_container stderr=",n)},onerr:function(n){console.log("up_container err=",n)}})}),[n]),(0,I.jsx)(h.Z,{ref:t,width:"100vh",height:"100vh"})}function z(n){var e=(0,s.useState)(0),t=(0,a.Z)(e,2),r=t[0],o=t[1],i=(0,s.useState)(""),c=(0,a.Z)(i,2),u=c[0],l=(c[1],(0,s.useState)(10)),d=(0,a.Z)(l,2),f=d[0],p=d[1],h=(0,s.useState)(!0),b=(0,a.Z)(h,2),y=(b[0],b[1],n.data.filter((function(n){return Object.values(n).some((function(n){return n.toString().toLowerCase().includes(u.toLowerCase())}))})));return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(m.Z,{component:Z.Z,children:(0,I.jsxs)(v.Z,{children:[(0,I.jsx)(g.Z,{children:(0,I.jsxs)(x.Z,{children:[(0,I.jsx)(k.Z,{children:"\u64cd\u4f5c"}),(0,I.jsx)(k.Z,{children:"\u540d\u79f0"}),(0,I.jsx)(k.Z,{children:"\u72b6\u6001"}),(0,I.jsx)(k.Z,{children:"\u7aef\u53e3"}),(0,I.jsx)(k.Z,{children:"mount"})]})}),(0,I.jsx)(w.Z,{children:y.slice(r*f,r*f+f).map((function(e){return(0,I.jsxs)(x.Z,{children:[(0,I.jsxs)(k.Z,{children:[n.onUp&&(0,I.jsx)(_.Z,{onClick:function(){return n.onUp(e)},children:"\u542f\u52a8"}),n.onDown&&(0,I.jsx)(_.Z,{onClick:function(){return n.onDown(e)},children:"\u505c\u6b62"}),n.onConfig&&(0,I.jsx)(_.Z,{onClick:function(){return n.onConfig(e)},children:"\u914d\u7f6e"})]}),(0,I.jsx)(k.Z,{children:e.name}),(0,I.jsx)(k.Z,{children:e.status}),(0,I.jsx)(k.Z,{children:e.port}),(0,I.jsx)(k.Z,{children:e.mount})]},e.name)}))})]})}),(0,I.jsx)(j.Z,{component:"div",count:y.length,page:r,onPageChange:function(n,e){o(e)},rowsPerPage:f,onRowsPerPageChange:function(n){p(parseInt(n.target.value,10)),o(0)},style:{marginTop:"1rem"}})]})}var O=function(n){var e=(0,s.useRef)(null),t=(0,s.useRef)(null),r=(0,s.useState)(""),o=(0,a.Z)(r,2);o[0],o[1];return(0,s.useEffect)((function(){e.current=new l.Terminal({rows:40,convertEol:!0,scrollback:10,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0});var r=new d.FitAddon;e.current.loadAddon(r),e.current.onResize((function(n){r.fit()})),e.current.open(t.current),null!=n.data&&c.default[n.data.op]({stdout:function(n){console.log("up_container=",n),e.current&&e.current.write(n)},stderr:function(n){console.log("up_container stderr=",n)},onerr:function(n){console.log("up_container err=",n)},onend:function(){n.onEnd&&n.onEnd()}})}),[n]),(0,I.jsx)(h.Z,{ref:t,width:"100vh",height:"100vh"})};function N(n){var e=(0,s.useState)(!1),t=(0,a.Z)(e,2),l=t[0],d=t[1],h=(0,s.useState)([]),m=(0,a.Z)(h,2),Z=m[0],v=m[1],g=(0,s.useState)(!1),x=(0,a.Z)(g,2),k=x[0],w=x[1],j=(0,s.useState)(!1),N=(0,a.Z)(j,2),T=N[0],W=N[1],A=(0,s.useState)(null),D=(0,a.Z)(A,2),F=D[0],J=D[1],U=(0,s.useState)({install_dialog:!1,run_command:{}}),P=(0,a.Z)(U,2),L=P[0],q=P[1],B=(0,s.useState)({title:"",env:"",config:""}),M=(0,a.Z)(B,2),G=M[0],H=M[1],K=(0,f.useData)(),Q=(K.global_data,K.api),X=function(n){q((function(e){return(0,i.Z)((0,i.Z)({},e),n)}))},Y=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(){var e,t;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Q.config_file({filename:"config/docker.config",op:"get"});case 2:0==(e=n.sent).ret&&e.data&&(t=JSON.parse(e.data),v(t));case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),$=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(){var e,t,o,i,a,s,u,l,f,p,h,m;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.default.check_install();case 2:if(0!=(e=n.sent).ret||!e.data||""==e.data.stdout){n.next=12;break}return d(!0),X({install_dialog:!1,run_command:{}}),n.next=8,Y();case 8:return n.next=10,c.default.list_all();case 10:if(0==(t=n.sent).ret&&t.data&&""!=t.data.stdout){for(o=t.data.stdout,i=o.split("\n"),a=[],s=1;s<i.length-1;s++)a.push(i[s]);if(a.length>1){for(u=a[0].split(/\s+/),l=[],f=1;f<a.length;f++){for(p=a[f].split(/\s+/),h={},m=0;m<u.length;m++)h[u[m]]=p[m];l.push(h)}v(l)}}case 12:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),nn=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(){var e;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e={},l||(e={op:"install"}),e.op?X({install_dialog:!0,run_command:e}):X({install_dialog:!1});case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),en=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(e){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:J((0,i.Z)((0,i.Z)({},e),{},{op:"start_container"})),W(!0);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),tn=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(e){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:J((0,i.Z)((0,i.Z)({},e),{},{op:"stop_container"})),W(!0);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),rn=function(){return(0,I.jsx)(z,{data:Z,onUp:en,onConfig:fn,onDown:tn})},on=function(){w(!1)},an=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(e){var t,o,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=pn.current.getValue(),console.log("config==",t),n.next=4,c.default.save_config(t);case 4:if(o=n.sent,console.log("save ret=",o),0!=o.ret){n.next=14;break}return i=Z.findIndex((function(n){return n.dir=="".concat(c.default.docker_config,"/").concat(t.title)})),i>=0?Z.splice(i,1,{name:t.title,dir:"".concat(c.default.docker_config,"/").concat(t.title)}):Z.push({name:t.title,dir:"".concat(c.default.docker_config,"/").concat(t.title)}),n.next=11,Q.config_file({filename:"config/docker.config",op:"put",data:JSON.stringify(Z)});case 11:n.sent,v(Z),w(!1);case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),sn=(0,s.useState)({type:"object",title:"\u65b0\u5efadocker\u5bb9\u5668",properties:{title:{type:"string",title:"\u5bb9\u5668\u540d\u79f0"},env:{type:"string",title:"\u73af\u5883\u53d8\u91cf",format:"ini",default:"",options:{ace:{theme:"ace/theme/vibrant_ink",tabSize:2,useSoftTabs:!0,wrap:!0}}},config:{type:"string",format:"yaml",title:"docker\u914d\u7f6e",default:"",options:{ace:{theme:"ace/theme/vibrant_ink",tabSize:2,useSoftTabs:!0,wrap:!0}}}},require:["title","env","config"]}),cn=(0,a.Z)(sn,2),un=cn[0],ln=cn[1],dn=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:un.title="\u65b0\u5efa",ln(un),w(!0);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),fn=function(){var n=(0,o.Z)((0,r.Z)().mark((function n(e){var t,o,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return un.title="\u4fee\u6539\u5bb9\u5668",ln(un),t=e.name,o=e.dir,n.next=6,c.default.get_config({title:t,dir:o});case 6:0==(i=n.sent).ret&&(H({title:e.name,env:i.env.data,config:i.compose.data}),w(!0));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),pn=(0,s.useRef)(null),hn=(0,p.Z)(b.Z)({width:"80%"}),mn=function(){return(0,I.jsxs)(y.Z,{open:k,onClose:on,fullWidth:!0,maxWidth:"md",children:[(0,I.jsx)(S.Z,{children:"\u914d\u7f6e"}),(0,I.jsx)(hn,{children:(0,I.jsx)(u.default,{schema:un,ref:pn,data:G})}),(0,I.jsxs)(C.Z,{children:[(0,I.jsx)(_.Z,{onClick:an,children:"\u4fdd\u5b58"}),(0,I.jsx)(_.Z,{onClick:on,children:"\u53d6\u6d88"})]})]})},Zn=function(){W(!1)};(0,s.useEffect)((function(){return $(),function(){}}),[]);var vn=function(){return(0,I.jsxs)(y.Z,{open:T,onClose:Zn,fullWidth:!0,maxWidth:"md",children:[(0,I.jsx)(S.Z,{children:"\u542f\u52a8\u5bb9\u5668"}),(0,I.jsx)(hn,{children:(0,I.jsx)(V,{data:F})}),(0,I.jsx)(C.Z,{children:(0,I.jsx)(_.Z,{onClick:Zn,children:"\u53d6\u6d88"})})]})};return(0,I.jsx)(I.Fragment,{children:(0,I.jsx)(E.default,(0,i.Z)((0,i.Z)({title:"docker"},n),{},{children:(0,I.jsxs)(R.Z,{children:[!l&&(0,I.jsx)(_.Z,{onClick:nn,children:"\u5b89\u88c5docker"}),l&&(0,I.jsx)(_.Z,{onClick:dn,children:"\u65b0\u5efa\u5bb9\u5668"}),(0,I.jsx)(rn,{}),(0,I.jsx)(mn,{}),(0,I.jsx)(vn,{}),L.install_dialog&&(0,I.jsxs)(y.Z,{open:L.install_dialog,onClose:function(){return console.log("close")},children:[(0,I.jsx)(S.Z,{children:"\u521d\u59cb\u5316"}),(0,I.jsx)(hn,{children:(0,I.jsx)(O,{data:L.run_command,onEnd:$})}),(0,I.jsx)(C.Z,{})]})]})}))})}},16118:function(n,e,t){t.r(e);var r=t(1413),o=t(70885),i=t(15671),a=t(43144),s=t(60136),c=t(98557),u=t(72791),l=t(1250),d=t(28714),f=t(19935),p=t(19218),h=t(80184),m=window.JSONEditor,Z=function(n){(0,s.Z)(t,n);var e=(0,c.Z)(t);function t(){return(0,i.Z)(this,t),e.apply(this,arguments)}return(0,a.Z)(t,[{key:"build",value:function(){var n=this,e=(this.value,this);this.title=this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired()),this.container.appendChild(this.title);var t=this.options.disks;this.disks=t;var i=document.createElement("div");this.container.append(i),this.view_root=l.createRoot(i),this.rix_init_flag=!1;var a=function(e,t){e.preventDefault(),n.setValue(t,!1,!1)};if(this.used_disks=(0,d.rix_make_watch_data)({used:[],cur_path:""}),this.parent.parent&&this.parent.parent.schema.uniqueItems){var s=this.parent.parent;this.jsoneditor.watch(s.path,(function(){var e=s.getValue().map((function(n){return n.path}));n.used_disks.set("used",e)}))}this.set_model=function(n){if(e.parent&&e.parent.jsoneditor){var t=e.parent.jsoneditor.getEditor(e.parent.path+".model");if(t&&e.disks){var r=n,o=e.disks.filter((function(n){return n.path==r}))[0];o&&t.setValue(o.model)}}},this.used_disks.watch("cur_path",this.set_model);var c=this.defaults.global_data,m=function(){var e=(0,u.useState)([]),i=(0,o.Z)(e,2),s=i[0],l=i[1],d=(0,u.useState)(""),m=(0,o.Z)(d,2),Z=m[0],v=m[1];return t||(t=c.get("blockdevices")),n.disks=t,(0,u.useEffect)((function(){var e=function(n){var e=t.map((function(n){return n.path}));e=e.filter((function(e){return 0==n.filter((function(n){return n==e})).length})),l(e)};n.used_disks.watch("used",e);var r;return e(n.used_disks.get("used")),r=n.used_disks.get("cur_path"),v(r),n.set_model(r),function(){n.used_disks.unwatch("used",e)}}),[]),(0,h.jsx)(f.Z,{freeSolo:!0,value:Z,onChange:a,options:s,getOptionLabel:function(n){var e=t.filter((function(e){return e.path==n}))[0];return e?"".concat(e.model,"(").concat(e.size,") at ").concat(e.path):""},renderInput:function(n){return(0,h.jsx)(p.Z,(0,r.Z)((0,r.Z)({},n),{},{label:"\u9009\u62e9\u78c1\u76d8"}))}})};this.view_root.render((0,h.jsx)(m,{}))}},{key:"setValue",value:function(n,e,t){this.value=n,this.refreshValue(),this.used_disks.set("cur_path",n),this.onChange(!0)}},{key:"getValue",value:function(){return this.value}},{key:"destroy",value:function(){var n=this;this.used_disks.unwatch(this.set_model),setTimeout((function(){n.view_root.unmount()}))}}]),t}(m.AbstractEditor),v=(0,u.forwardRef)((function(n,e){var t=n.schema,o=(n.callbacks,(0,u.useRef)(null)),i=(0,u.useRef)(null),a=(0,d.useData)().global_data;m.defaults.editors.disk_select=Z,m.defaults.global_data=a,m.defaults.resolvers.unshift((function(n){if("string"===n.type&&"disk_select"===n.format)return"disk_select"})),(0,u.useEffect)((function(){var e=(0,r.Z)({schema:t,theme:"bootstrap4"},n.options);return o.current=new m(i.current,e),o.current.on("ready",(function(){n.data&&o.current.setValue(n.data)})),function(){o.current&&o.current.destroy()}}),[t,n]);var s=function(){return o.current.getValue()};return(0,u.useImperativeHandle)(e,(function(){return{getValue:s}})),(0,h.jsx)("div",(0,r.Z)({ref:i},n))}));e.default=v},95806:function(n,e,t){t.r(e);var r=t(74165),o=t(15861),i=t(11687);t(28714);var a={docker_config:"./docker",get_config:function(n){var e=this;return(0,o.Z)((0,r.Z)().mark((function t(){var o,a,s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="".concat(e.docker_config,"/").concat(n.title),t.next=3,e.mkdir(o);case 3:return t.sent,t.next=6,i.default.config_file({op:"get",filename:"".concat(o,"/.env")});case 6:return a=t.sent,t.next=9,i.default.config_file({op:"get",filename:"".concat(o,"/docker-compose.yml"),data:n.config});case 9:if(s=t.sent,0!=a.ret||0!=s.ret){t.next=14;break}return t.abrupt("return",{ret:0,env:a,compose:s});case 14:return t.abrupt("return",{ret:-2,env:a,compose:s});case 15:case"end":return t.stop()}}),t)})))()},stop_container:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{stdout:null,stderr:null,onerr:null},t=window.location,r={command:"/bin/bash",args:["-c","cd ".concat(n.dir," && docker compose stop")]},o=encodeURIComponent(JSON.stringify(r)),i=new WebSocket(("http:"==t.protocol?"ws://":"wss://")+t.host+"/api/ws/shell?args="+o);i.onopen=function(){i.onclose=function(){i=null},i.onmessage=function(n){console.log(n.data),e.stdout&&e.stdout(n.data)}},i.onerror=function(n){e.onerr&&e.onerr(n),i=null}},start_container:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{stdout:null,stderr:null,onerr:null},t=window.location,r={command:"/bin/bash",args:["-c","cd ".concat(n.dir," && docker compose up -d")]},o=encodeURIComponent(JSON.stringify(r)),i=new WebSocket(("http:"==t.protocol?"ws://":"wss://")+t.host+"/api/ws/shell?args="+o);i.onopen=function(){i.onclose=function(){i=null},i.onmessage=function(n){console.log(n.data),e.stdout&&e.stdout(n.data)}},i.onerror=function(n){e.onerr&&e.onerr(n),i=null}},mkdir:function(n){return(0,o.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={command:"mkdir",args:["-p",n]},e.next=3,i.default.run_command(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()},save_config:function(n){var e=this;return(0,o.Z)((0,r.Z)().mark((function t(){var o,a,s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="".concat(e.docker_config,"/").concat(n.title),t.next=3,e.mkdir(o);case 3:return t.sent,t.next=6,i.default.config_file({op:"put",filename:"".concat(o,"/.env"),data:n.env});case 6:return a=t.sent,t.next=9,i.default.config_file({op:"put",filename:"".concat(o,"/docker-compose.yml"),data:n.config});case 9:if(s=t.sent,0!=a.ret||0!=s.ret){t.next=14;break}return t.abrupt("return",{ret:0,env:a,compose:s});case 14:return t.abrupt("return",{ret:-2,env:a,compose:s});case 15:case"end":return t.stop()}}),t)})))()},start:function(){return(0,o.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:case"end":return n.stop()}}),n)})))()},stop:function(){return(0,o.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:case"end":return n.stop()}}),n)})))()},list:function(){return(0,o.Z)((0,r.Z)().mark((function n(){return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:case"end":return n.stop()}}),n)})))()},list_all:function(){return(0,o.Z)((0,r.Z)().mark((function n(){var e;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e={command:"docker",args:["ps","-a"]},n.next=3,i.default.run_command(e);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()},install:function(){!function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{stdout:null,stderr:null,onerr:null,onend:null},t=window.location,r=n,o=encodeURIComponent(JSON.stringify(r)),i=new WebSocket(("http:"==t.protocol?"ws://":"wss://")+t.host+"/api/ws/shell?args="+o);i.onopen=function(){i.onclose=function(){i=null,e.onend&&e.onend()},i.onmessage=function(n){console.log(n.data),e.stdout&&e.stdout(n.data)}},i.onerror=function(n){e.onerr&&e.onerr(n),i=null}}({command:"./scripts/install_docker_debian.sh",args:["docker"]},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{stdout:null,stderr:null,onerr:null,onend:null})},check_install:function(){return(0,o.Z)((0,r.Z)().mark((function n(){var e;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e={command:"which",args:["docker"]},n.next=3,i.default.run_command(e);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})))()}};e.default=a}}]);
//# sourceMappingURL=380.8c93b544.chunk.js.map