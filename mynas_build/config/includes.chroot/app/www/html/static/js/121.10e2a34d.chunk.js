"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[121,905,118,583,149],{7905:function(e,t,n){n.r(t);var a=n(42982),r=n(1413),s=n(70885),o=n(72791),i=n(39281),u=n(35527),c=n(79836),l=n(56890),d=n(35855),f=n(53994),p=n(53382),h=n(36151),m=n(89341),v=n(28714),g=n(80184);t.default=function(e){var t=(0,o.useState)([]),n=(0,s.Z)(t,2),_=n[0],Z=n[1],x=(0,o.useState)([]),b=(0,s.Z)(x,2),k=b[0],y=b[1],j=(0,o.useState)(!0),w=(0,s.Z)(j,2),S=(w[0],w[1],(0,o.useState)(0)),C=(0,s.Z)(S,2),z=C[0],I=C[1],E=(0,o.useState)(10),D=(0,s.Z)(E,2),R=D[0],V=D[1],O=(0,o.useState)({online:!1,status_text:"\u79bb\u7ebf"}),q=(0,s.Z)(O,2),A=(q[0],q[1],(0,o.useState)("")),J=(0,s.Z)(A,2),N=J[0],P=(J[1],_.filter((function(e){return Object.values(e).some((function(e){return e.toString().toLowerCase().includes(N.toLowerCase())}))}))),T=(0,v.useData)(),L=T.global_data;return T.api,(0,o.useEffect)((function(){L.get("blockdevices");var e=function(e){var t=L.get("blockdevices"),n=_,s=e;k.forEach((function(e){var a=s.filter((function(t){return e.path=="/dev/".concat(t.Device)}))[0];if(t){var o=t.filter((function(t){return t.path===e.path}))[0];if(a&&o){var i=n.findIndex((function(t){return t.path==e.path}));i>=0?n.splice(i,1,(0,r.Z)((0,r.Z)({},o),{},{id:e.path},a)):n.push((0,r.Z)((0,r.Z)({},o),{},{id:e.path},a))}}})),Z((0,a.Z)(n))};return L.watch("sysstat",e),Z(k),function(){L.unwatch("sysstat",e)}}),[k]),(0,o.useEffect)((function(){console.log("props===",e),e.data&&y(e.data)}),[e.data]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(i.Z,{component:u.Z,children:(0,g.jsxs)(c.Z,{children:[(0,g.jsx)(l.Z,{children:(0,g.jsxs)(d.Z,{children:[(0,g.jsx)(f.Z,{children:"\u8bbe\u5907"}),(0,g.jsx)(f.Z,{children:"PATH"}),(0,g.jsx)(f.Z,{children:"\u6807\u8bc6"}),(0,g.jsx)(f.Z,{children:"\u5bb9\u91cf"}),(0,g.jsx)(f.Z,{children:"\u8bfb\u53d6"}),(0,g.jsx)(f.Z,{children:"\u5199\u5165"})]})}),(0,g.jsx)(p.Z,{children:P.slice(z*R,z*R+R).map((function(t){return(0,g.jsxs)(d.Z,{children:[(0,g.jsxs)(f.Z,{children:[e.onDown&&(0,g.jsx)(h.Z,{onClick:function(){return e.onDown(t)},children:"\u4e0b\u7ebf"}),e.onAdd&&e.check_add_status&&e.check_add_status(t)&&(0,g.jsx)(h.Z,{onClick:function(){return e.onAdd(t)},children:"\u6dfb\u52a0\u5230\u6c60"}),e.onRemove&&(0,g.jsx)(h.Z,{onClick:function(){return e.onRemove(t)},children:"\u79fb\u9664"})]}),(0,g.jsx)(f.Z,{children:t.path}),(0,g.jsxs)(f.Z,{children:[t.model," ",t.serial," ",t.size]}),(0,g.jsx)(f.Z,{children:t.size}),(0,g.jsx)(f.Z,{children:t["kB_read/s"]}),(0,g.jsx)(f.Z,{children:t["kB_wrtn/s"]})]},t.path)}))})]})}),(0,g.jsx)(m.Z,{component:"div",count:P.length,page:z,onPageChange:function(e,t){I(t)},rowsPerPage:R,onRowsPerPageChange:function(e){V(parseInt(e.target.value,10)),I(0)},style:{marginTop:"1rem"}})]})}},51121:function(e,t,n){n.r(t);var a=n(37762),r=n(1413),s=n(42982),o=n(74165),i=n(15861),u=n(70885),c=n(72791),l=n(11687),d=n(16118),f=n(70583),p=n(99059),h=n(39157),m=n(5289),v=n(65661),g=n(97123),_=n(36151),Z=n(76149),x=n(28714),b=n(7905),k=n(80184);t.default=function(){var e=(0,c.useState)([]),t=(0,u.Z)(e,2),n=t[0],y=t[1],j=(0,c.useState)([]),w=(0,u.Z)(j,2),S=w[0],C=w[1],z=(0,c.useState)({id:0,key:"",status:0,type:0,value:"",parent_id:0}),I=(0,u.Z)(z,2),E=I[0],D=(I[1],(0,c.useState)(!0)),R=(0,u.Z)(D,2),V=(R[0],R[1],(0,c.useContext)(x.DataContext)),O=(0,c.useState)({}),q=(0,u.Z)(O,2),A=q[0],J=q[1],N=(0,c.useState)(!1),P=(0,u.Z)(N,2),T=P[0],L=P[1];(0,c.useEffect)((function(){var e=function(e){y(e)};V.watch("blockdevices",e);var t=V.get("pools",[],(0,i.Z)((0,o.Z)().mark((function e(){var t,n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.config_file({filename:"config/pools.config",op:"get"});case 2:0==(t=e.sent).ret&&(n=JSON.parse(t.data),C(n),V.set("pools",n));case 4:case"end":return e.stop()}}),e)}))));C(t);var n=function(e){console.log("update pools=",e),C((0,s.Z)(e)),console.log("after pools=",S)};return console.log("watch pools"),V.watch("pools",n),l.default.disk_info({}),function(){V.unwatch("blockdevices",e),console.log("unwatch pools"),V.unwatch("pools",n)}}),[]);var $=(0,c.useRef)(null),B=function(){L(!1)},F=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n,a,s,i,u,c,d,f,p;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=$.current.getValue(),console.log("save===",t),e.t0=t.op,e.next="add_device_to_pool"===e.t0?6:"addpool"===e.t0?21:41;break;case 6:return console.log("add device to pool",t),n=S.findIndex((function(e){return e.name==t.pool})),a=null,n>=0&&(a=S[n]),e.next=12,l.default.run_command((0,r.Z)({},Z.default.device.add((0,r.Z)((0,r.Z)({},t),{},{mount_path:a.mount_path}))));case 12:if(0!=e.sent.ret){e.next=20;break}return(s=a.label.findIndex((function(e){return e.path==t.device})))>=0?a.label.splice(s,1,(0,r.Z)((0,r.Z)({},a.label[s]),{},{name:t.label,path:t.device})):a.label.push({name:t.label,path:t.device}),e.next=18,l.default.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(S)});case 18:0==e.sent.ret&&(V.set("pools",S),L(!1));case 20:return e.abrupt("break",41);case 21:return e.next=23,l.default.run_command((0,r.Z)((0,r.Z)({},Z.default.format(t)),{},{config:t}));case 23:if(i=e.sent,console.log("format_ret===",i),0!=i.ret){e.next=40;break}return u=t.name,(d=(c=S).findIndex((function(e){return e.name==u})))>=0?c.split(d,1,t):c.push(t),V.set("pools",c),e.next=33,l.default.config_file({op:"put",filename:"config/pools.config",data:JSON.stringify(c)});case 33:if(0==(f=e.sent).ret&&console.log("write_config ok=",f),1!=t.auto_mount){e.next=40;break}return e.next=38,l.default.run_command((0,r.Z)((0,r.Z)({},Z.default.mount(t)),{},{config:t}));case 38:p=e.sent,console.log("mount_ret===",p);case 40:return e.abrupt("break",41);case 41:e.next=46;break;case 43:e.prev=43,e.t1=e.catch(0),console.error("Error saving parameter:",e.t1);case 46:case"end":return e.stop()}}),e,null,[[0,43]])})));return function(){return e.apply(this,arguments)}}(),H=(0,p.Z)(h.Z)({width:"80%"}),W=function(){return(0,k.jsxs)(m.Z,{open:T,onClose:B,fullWidth:!0,maxWidth:"md",children:[(0,k.jsx)(v.Z,{children:"\u6dfb\u52a0\u53c2\u6570"}),(0,k.jsx)(H,{children:(0,k.jsx)(d.default,{schema:A,ref:$,data:E})}),(0,k.jsxs)(g.Z,{children:[(0,k.jsx)(_.Z,{onClick:F,children:"\u4fdd\u5b58"}),(0,k.jsx)(_.Z,{onClick:B,children:"\u53d6\u6d88"})]})]})},G=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.default.config_file({filename:"disk.config",op:"get"});case 2:if(t=e.sent,console.log("disk_config==",t),-2!=t.ret){e.next=9;break}return e.next=7,l.default.config_file({filename:"disk.config",op:"put",data:JSON.stringify({blockdevices:V.get("blockdevices")})});case 7:n=e.sent,console.log("d_w_ret=",n);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e,t=[],n=(0,a.Z)(S);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push((0,k.jsx)(f.default,{data:r},r))}}catch(s){n.e(s)}finally{n.f()}return t};return(0,k.jsxs)("div",{children:[(0,k.jsx)(_.Z,{onClick:function(e){e.preventDefault();J({$ref:"#/definitions/bcachefs_config",definitions:{bcachefs_label:{type:"array",title:"\u6807\u7b7e\u914d\u7f6e",uniqueItems:!0,items:{type:"object",headerTemplate:"{{self.name}}={{self.path}}",properties:{name:{type:"string",default:"",title:"label_name"},path:{type:"string",format:"disk_select",title:"\u8bbe\u5907"},model:{type:"string",title:"\u786c\u76d8",options:{hidden:!0}}},required:["name","path","model"]}},bcachefs_config:{type:"object",properties:{op:{type:"string",default:"addpool",options:{hidden:!0}},name:{type:"string",title:"\u540d\u79f0",default:"pool"},compression:{type:"string",title:"\u538b\u7f29\u65b9\u5f0f",enum:["none","lz4","gzip","zstd"],default:"none",options:{enum_titles:["none","lz4","gzip","zstd"]}},encrypted:{type:"boolean",title:"\u52a0\u5bc6",default:!1},replicas:{type:"integer",title:"\u6570\u636e\u526f\u672c\u6570\u91cf",default:1},foreground_target:{type:"string",title:"\u524d\u7aef\u8bbe\u5907\u6807\u7b7e",default:""},promote_target:{type:"string",title:"promote_target\u8bbe\u5907\u6807\u7b7e",default:""},background_target:{type:"string",title:"\u540e\u7aef\u8bbe\u5907\u6807\u7b7e",default:""},label:{title:"\u5b58\u50a8\u6807\u7b7e\u8bbe\u7f6e",$ref:"#/definitions/bcachefs_label"},auto_mount:{type:"boolean",title:"\u81ea\u52a8\u6302\u8f7d",default:!1},mount_path:{type:"string",title:"\u6302\u8f7d\u8def\u5f84",default:"/mnt"}},required:["op","name","compression","encrypted","replicas","foreground_target","promote_target","background_target","label","auto_mount","mount_path"]}}}),L(!0)},children:"\u6dfb\u52a0\u6c60"}),(0,k.jsx)(_.Z,{onClick:G,children:"test"}),(0,k.jsx)(W,{}),(0,k.jsx)(K,{}),(0,k.jsx)(b.default,{data:n,onAdd:function(e){console.log("onAdd");var t=S.map((function(e){return e.name}));console.log("pools==",t),J({$ref:"#/definitions/config",definitions:{config:{type:"object",title:"\u52a0\u5165\u5230\u6c60",properties:{op:{type:"string",default:"add_device_to_pool",options:{hidden:!0}},device:{type:"string",default:e.path,options:{hidden:!0}},pool:{type:"string",title:"\u6c60\u540d\u5b57",enum:t,options:{enum_titles:t}},label:{type:"string",title:"\u6807\u7b7e",default:""},fs_size:{type:"string",title:"fs_size",default:""},discard:{type:"boolean",title:"discard",default:!1},bucket:{type:"string",title:"bucket",default:""}},required:["op","device","pool","label","fs_size","discard","bucket"]}}}),L(!0)},check_add_status:function(e){var t,n=(0,a.Z)(S);try{for(n.s();!(t=n.n()).done;){if(t.value.label.findIndex((function(t){return t.path==e.path}))>=0)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}})]})}},16118:function(e,t,n){n.r(t);var a=n(1413),r=n(70885),s=n(15671),o=n(43144),i=n(60136),u=n(98557),c=n(72791),l=n(1250),d=n(28714),f=n(19935),p=n(19218),h=n(80184),m=window.JSONEditor,v=function(e){(0,i.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"build",value:function(){var e=this,t=(this.value,this);this.title=this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired()),this.container.appendChild(this.title);var n=this.options.disks;this.disks=n;var s=document.createElement("div");this.container.append(s),this.view_root=l.createRoot(s),this.rix_init_flag=!1;var o=function(t,n){t.preventDefault(),e.setValue(n,!1,!1)};if(this.used_disks=(0,d.rix_make_watch_data)({used:[],cur_path:""}),this.parent.parent&&this.parent.parent.schema.uniqueItems){var i=this.parent.parent;this.jsoneditor.watch(i.path,(function(){var t=i.getValue().map((function(e){return e.path}));e.used_disks.set("used",t)}))}this.set_model=function(e){if(t.parent&&t.parent.jsoneditor){var n=t.parent.jsoneditor.getEditor(t.parent.path+".model");if(n&&t.disks){var a=e,r=t.disks.filter((function(e){return e.path==a}))[0];r&&n.setValue(r.model)}}},this.used_disks.watch("cur_path",this.set_model);var u=this.defaults.global_data,m=function(){var t=(0,c.useState)([]),s=(0,r.Z)(t,2),i=s[0],l=s[1],d=(0,c.useState)(""),m=(0,r.Z)(d,2),v=m[0],g=m[1];return n||(n=u.get("blockdevices")),e.disks=n,(0,c.useEffect)((function(){var t=function(e){var t=n.map((function(e){return e.path}));t=t.filter((function(t){return 0==e.filter((function(e){return e==t})).length})),l(t)};e.used_disks.watch("used",t);var a;return t(e.used_disks.get("used")),a=e.used_disks.get("cur_path"),g(a),e.set_model(a),function(){e.used_disks.unwatch("used",t)}}),[]),(0,h.jsx)(f.Z,{freeSolo:!0,value:v,onChange:o,options:i,getOptionLabel:function(e){var t=n.filter((function(t){return t.path==e}))[0];return t?"".concat(t.model,"(").concat(t.size,") at ").concat(t.path):""},renderInput:function(e){return(0,h.jsx)(p.Z,(0,a.Z)((0,a.Z)({},e),{},{label:"\u9009\u62e9\u78c1\u76d8"}))}})};this.view_root.render((0,h.jsx)(m,{}))}},{key:"setValue",value:function(e,t,n){this.value=e,this.refreshValue(),this.used_disks.set("cur_path",e),this.onChange(!0)}},{key:"getValue",value:function(){return this.value}},{key:"destroy",value:function(){var e=this;this.used_disks.unwatch(this.set_model),setTimeout((function(){e.view_root.unmount()}))}}]),n}(m.AbstractEditor),g=(0,c.forwardRef)((function(e,t){var n=e.schema,r=(e.callbacks,(0,c.useRef)(null)),s=(0,c.useRef)(null),o=(0,d.useData)().global_data;m.defaults.editors.disk_select=v,m.defaults.global_data=o,m.defaults.resolvers.unshift((function(e){if("string"===e.type&&"disk_select"===e.format)return"disk_select"})),(0,c.useEffect)((function(){var t=(0,a.Z)({schema:n,theme:"bootstrap4"},e.options);return r.current=new m(s.current,t),r.current.on("ready",(function(){e.data&&r.current.setValue(e.data)})),function(){r.current&&r.current.destroy()}}),[n,e]);var i=function(){return r.current.getValue()};return(0,c.useImperativeHandle)(t,(function(){return{getValue:i}})),(0,h.jsx)("div",(0,a.Z)({ref:s},e))}));t.default=g},70583:function(e,t,n){n.r(t);var a=n(74165),r=n(15861),s=n(70885),o=n(72791),i=n(36151),u=n(76149),c=n(28714),l=n(7905),d=n(80184);t.default=function(e){var t=e.data;console.log("pool=",t);var n=(0,c.useData)(),f=n.global_data,p=n.api,h=(0,o.useState)([]),m=(0,s.Z)(h,2),v=m[0],g=m[1];(0,o.useEffect)((function(){g(e.data.label)}),[e.data]);var _=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){var r,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.run_command(u.default.device.evacuate({device:n.path,mount_path:t.mount_path}));case 2:if(0!=e.sent.ret){e.next=17;break}return e.next=6,p.run_command(u.default.device.remove({device:n.path,mount_path:t.mount_path}));case 6:if(0!=e.sent.ret){e.next=17;break}return(r=t.label.findIndex((function(e){return e.path==n.path})))>=0&&t.label.splice(r,1),s=f.get("pools"),(r=s.findIndex((function(e){return e.name===t.name})))>=0&&s.splice(r,1,t),e.next=15,p.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(s)});case 15:0==e.sent.ret&&(g(t.label),f.set("pools",s));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=(0,o.useState)({online:!1,status_text:"\u79bb\u7ebf"}),n=(0,s.Z)(e,2),c=n[0],l=n[1],f=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.mount_path,e.next=3,p.run_command(u.default.fs.usage(n));case 3:0==(r=e.sent).ret?(r.data.stdout.split("\n"),l({online:!0,status_text:"\u5728\u7ebf"})):l({online:!1,status_text:"\u79bb\u7ebf"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,p.run_command(u.default.mount(t));case 3:return e.sent,e.next=6,f();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,p.run_command(u.default.umount(t));case 3:return e.sent,e.next=6,f();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){var e=setInterval((function(){f()}),6e4);return f(),function(){clearInterval(e)}}),[]),(0,d.jsxs)("div",{children:["\u540d\u79f0:",t.name," \u6302\u8f7d\u4f4d\u7f6e: ",t.mount_path," \u72b6\u6001:",c.online&&(0,d.jsx)(i.Z,{onClick:m,children:"\u5378\u8f7d"}),!c.online&&(0,d.jsx)(i.Z,{onClick:h,children:"\u6302\u8f7d"})]})};return(0,d.jsxs)("div",{children:[(0,d.jsx)(Z,{}),(0,d.jsx)(l.default,{data:v,onDown:function(e){console.log("down==",e)},onRemove:_}),";"]})}},76149:function(e,t,n){n.r(t);var a=n(37762),r={command:"bcachefs",fs:{usage:function(e){var t=[];return t.push("fs"),t.push("usage"),t.push(e),{command:"bcachefs",args:t}}},device:{remove:function(e){var t=[];return t.push("device"),t.push("remove"),t.push(e.device),t.push(e.mount_path),{command:"bcachefs",args:t}},add:function(e){var t=[];return t.push("device"),t.push("add"),e.label&&""!=e.label&&t.push("--label=".concat(e.label)),e.fs_size&&""!=e.fs_size&&t.push("--fs_size=".concat(e.fs_size)),e.discard&&1==e.discard&&t.push("--discard"),e.bucket&&""!=e.bucket&&t.push("--bucket=".concat(e.bucket)),t.push(e.mount_path),t.push(e.device),{command:"bcachefs",args:t}},online:function(e){var t=[];return t.push("device"),t.push("online"),t.push(e.device),{command:"bcachefs",args:t}},offline:function(e){var t=[];return t.push("device"),t.push("offline"),t.push(e.device),{command:"bcachefs",args:t}},evacuate:function(e){var t=[];return t.push("device"),t.push("evacuate"),t.push(e.device),{command:"bcachefs",args:t}}},format:function(e){var t=[];t.push("format"),t.push("--compression=".concat(e.compression)),e.encrypted&&t.push("--encrypted"),t.push("--foreground_target=".concat(e.foreground_target)),t.push("--promote_target=".concat(e.promote_target)),t.push("--background_target=".concat(e.background_target)),t.push("--replicas=".concat(e.replicas));var n,r=(0,a.Z)(e.label);try{for(r.s();!(n=r.n()).done;){var s=n.value;t.push("--label=".concat(s.name)),t.push("".concat(s.path))}}catch(o){r.e(o)}finally{r.f()}return{command:this.command,args:t}},list:function(e){var t=[];return t.push("list"),t.push(e.path),{command:this.command,args:t}},list_journal:function(e){var t=[];return t.push("list_journal"),t.push(e.path),{command:this.command,args:t}},mount:function(e){var t=[];return t.push("-t"),t.push("bcachefs"),t.push(e.label.map((function(e){return e.path})).join(":")),t.push(e.mount_path),{command:"mount",args:t}},umount:function(e){var t=[];return t.push(e.mount_path),{command:"umount",args:t}}};t.default=r}}]);
//# sourceMappingURL=121.10e2a34d.chunk.js.map