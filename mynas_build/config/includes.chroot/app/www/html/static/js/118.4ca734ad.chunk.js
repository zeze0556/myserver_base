"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[118],{16118:function(t,e,n){n.r(e);var s=n(1413),i=n(70885),r=n(15671),a=n(43144),u=n(60136),o=n(98557),d=n(72791),c=n(1250),l=n(28714),h=n(19935),f=n(19218),p=n(80184),v=window.JSONEditor,_=function(t){(0,u.Z)(n,t);var e=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"build",value:function(){var t=this,e=(this.value,this);this.title=this.header=this.label=this.theme.getFormInputLabel(this.getTitle(),this.isRequired()),this.container.appendChild(this.title);var n=this.options.disks;this.disks=n;var r=document.createElement("div");this.container.append(r),this.view_root=c.createRoot(r),this.rix_init_flag=!1;var a=function(e,n){e.preventDefault(),t.setValue(n,!1,!1)};if(this.used_disks=(0,l.rix_make_watch_data)({used:[],cur_path:""}),this.parent.parent&&this.parent.parent.schema.uniqueItems){var u=this.parent.parent;this.jsoneditor.watch(u.path,(function(){var e=u.getValue().map((function(t){return t.path}));t.used_disks.set("used",e)}))}this.set_model=function(t){if(e.parent&&e.parent.jsoneditor){var n=e.parent.jsoneditor.getEditor(e.parent.path+".model");if(n&&e.disks){var s=t,i=e.disks.filter((function(t){return t.path==s}))[0];i&&n.setValue(i.model)}}},this.used_disks.watch("cur_path",this.set_model);var o=this.defaults.global_data,v=function(){var e=(0,d.useState)([]),r=(0,i.Z)(e,2),u=r[0],c=r[1],l=(0,d.useState)(""),v=(0,i.Z)(l,2),_=v[0],k=v[1];return n||(n=o.get("blockdevices")),t.disks=n,(0,d.useEffect)((function(){var e=function(t){var e=n.map((function(t){return t.path}));e=e.filter((function(e){return 0==t.filter((function(t){return t==e})).length})),c(e)};t.used_disks.watch("used",e);var s;return e(t.used_disks.get("used")),s=t.used_disks.get("cur_path"),k(s),t.set_model(s),function(){t.used_disks.unwatch("used",e)}}),[]),(0,p.jsx)(h.Z,{freeSolo:!0,value:_,onChange:a,options:u,getOptionLabel:function(t){var e=n.filter((function(e){return e.path==t}))[0];return e?"".concat(e.model,"(").concat(e.size,") at ").concat(e.path):""},renderInput:function(t){return(0,p.jsx)(f.Z,(0,s.Z)((0,s.Z)({},t),{},{label:"\u9009\u62e9\u78c1\u76d8"}))}})};this.view_root.render((0,p.jsx)(v,{}))}},{key:"setValue",value:function(t,e,n){this.value=t,this.refreshValue(),this.used_disks.set("cur_path",t),this.onChange(!0)}},{key:"getValue",value:function(){return this.value}},{key:"destroy",value:function(){var t=this;this.used_disks.unwatch(this.set_model),setTimeout((function(){t.view_root.unmount()}))}}]),n}(v.AbstractEditor),k=(0,d.forwardRef)((function(t,e){var n=t.schema,i=(t.callbacks,(0,d.useRef)(null)),r=(0,d.useRef)(null),a=(0,l.useData)().global_data;v.defaults.editors.disk_select=_,v.defaults.global_data=a,v.defaults.resolvers.unshift((function(t){if("string"===t.type&&"disk_select"===t.format)return"disk_select"})),(0,d.useEffect)((function(){var e=(0,s.Z)({schema:n,theme:"bootstrap4"},t.options);return i.current=new v(r.current,e),i.current.on("ready",(function(){t.data&&i.current.setValue(t.data)})),function(){i.current&&i.current.destroy()}}),[n,t]);var u=function(){return i.current.getValue()};return(0,d.useImperativeHandle)(e,(function(){return{getValue:u}})),(0,p.jsx)("div",(0,s.Z)({ref:r},t))}));e.default=k}}]);
//# sourceMappingURL=118.4ca734ad.chunk.js.map