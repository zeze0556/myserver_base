"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[597],{38597:function(t,e,a){a.r(e);var r=a(42982),n=a(1413),s=a(74165),o=a(15861),i=a(3623),c=a(11687);function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{stdout:null,stderr:null,onerr:null,onend:null},a=window.location,r=t,n=encodeURIComponent(JSON.stringify(r)),s=new WebSocket(("http:"==a.protocol?"ws://":"wss://")+a.host+"/api/ws/shell?args="+n);s.onopen=function(){s.onclose=function(){s=null,e.onend&&e.onend()},s.onmessage=function(t){console.log(t.data),e.stdout&&e.stdout(t.data)}},s.onerror=function(t){e.onerr&&e.onerr(t),s=null}}var l={command:"qemu-system",arch:"x86_64",check_virt_manager:function(){return(0,o.Z)((0,s.Z)().mark((function t(){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={command:"./scripts/install_virt_manager.sh",args:["check"]},t.next=3,c.default.run_command(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},install_virt_manager:function(){u({command:"./scripts/install_virt_manager.sh",args:["install_virt_manager"]},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{stdout:null,stderr:null,onerr:null,onend:null})},run_virt_manager:function(){u({command:"./scripts/install_virt_manager.sh",args:["run_virt_manager"]},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{stdout:null,stderr:null,onerr:null,onend:null})},check_x11_bridge:function(){return(0,o.Z)((0,s.Z)().mark((function t(){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={command:"./scripts/install_x11_bridge.sh",args:["check"]},t.next=3,c.default.run_command(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()},install_x11_bridge:function(){u({command:"./scripts/install_x11_bridge.sh",args:["install_x11_bridge"]},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{stdout:null,stderr:null,onerr:null,onend:null})},run_x11_bridge:function(){u({command:"./scripts/install_x11_bridge.sh",args:["run_x11_bridge"]},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{stdout:null,stderr:null,onerr:null,onend:null})},install:function(){u({command:"./scripts/install_qemu.sh",args:["qemu"]},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{stdout:null,stderr:null,onerr:null,onend:null})},template:{},parse_address:function(t){return t?{address:{_attributes:{type:"".concat(t.type),domain:"0x0000",bus:"".concat(t.bus),port:(null===t||void 0===t?void 0:t.port)||void 0,function:(null===t||void 0===t?void 0:t.function)||void 0,multifunction:(null===t||void 0===t?void 0:t.multifunction)||void 0}}}:{}},parse_usb:function(t){var e={controller:(0,n.Z)({_attributes:{type:"usb",index:(null===t||void 0===t?void 0:t.index)||"0",model:"".concat(t.model)},alias:{_attributes:{name:(null===t||void 0===t?void 0:t.alias_name)||"usb"}}},this.parse_address(t.address))};return t.master&&(e.controller.master={_attributes:{startport:"".concat(t.master.startport)}}),e},parse_disk:function(t){return{disk:(0,n.Z)({_attributes:{type:"file",device:"disk"},driver:{_attributes:{name:"qemu",type:"".concat(t.type),cache:"writeback"}},source:{_attributes:{file:"".concat(t.filename),index:"".concat(t.boot_order)}},backingStore:{},target:{_attributes:{dev:"hdc",bus:"".concat(t.bus_options)}},boot:{_attributes:{order:"".concat(t.boot_order)}},alias:{_attributes:{name:"virtio_disk2"}}},this.parse_address((null===t||void 0===t?void 0:t.address)||{type:"pci",bus:"0x03",slot:"0x00",function:"0x0"}))}},parse_pci:function(t){var e={controller:(0,n.Z)({_attributes:{type:"pci",index:"".concat(t.index),model:"".concat(t.model)},alias:{_attributes:"".concat(t.alias_name)}},this.parse_address((null===t||void 0===t?void 0:t.address)||{}))};if(t.model_name&&(e.controller.model={_attributes:{name:"".concat(t.model_name)}}),t.target){var a=t.target;e.controller.target={_attributes:{classis:"".concat(a.classis),port:"".concat(a.port)}}}return e},parse_network:function(t){return{interface:(0,n.Z)({_attributes:{type:(null===t||void 0===t?void 0:t.type)||"bridge"},mac:{_attributes:{address:"".concat(t.mac)}},source:{_attributes:{bridge:"".concat(t.network)}},target:{_attributes:{dev:"".concat(t.target)}},model:{_attributes:{type:"".concat(t.model)}},alias:{_attributes:{name:"".concat(t.alias_name)}}},this.parse_address(t.address))}},parse_serial:function(t){return{serial:{_attributes:{type:"".concat(t.type),tty:(null===t||void 0===t?void 0:t.tty)||void 0},source:{_attributes:{path:"".concat(t.path)}},target:{_attributes:{type:"".concat(t.target_type),port:"".concat(t.port)},model:{_attributes:{name:"".concat(t.target_type)}}},alias:{_attributes:{name:"".concat(t.alias_name)}}}}},parse_channel:function(t){return{channel:(0,n.Z)({_attributes:{type:"unix"},source:{_attributes:{mode:"bind",path:"".concat(t.path)}},target:{_attributes:{type:"virtio",name:"org.qemu.guest_agent.0",state:"disconnected"}},alias:{_attributes:{name:"channel0"}}},this.parse_address(t.address))}},parse_input:function(t){return{input:(0,n.Z)({_attributes:{type:"".concat(t.type),bus:"".concat(t.bus)},alias:{_attributes:{name:"".concat(t.alias_name)}}},this.parse_address(t.address))}},parse_console:function(t){return{console:{_attributes:{type:"pty",tty:"/dev/pts/2"},source:{_attributes:{path:"/dev/pts/2"}},target:{_attributes:{type:"serial",port:0}},alias:{_attributes:{name:"serial0"}}}}},parse_config:function(t){var e=this;console.log("config===",t);var a=[{model:"ich9-ehci1",address:{type:"pci",bus:"0x00",slot:"0x07",function:"0x0",multifunction:"on"}},{model:"ich9-uhci1",address:{type:"pci",bus:"0x00",slot:"0x07",function:"0x0"},master:{startport:0}},{model:"ich9-uhci2",address:{type:"pci",bus:"0x00",slot:"0x07",function:"0x1"},master:{startport:2}},{model:"ich9-uhci3",address:{type:"pci",bus:"0x00",slot:"0x07",function:"0x2"},master:{startport:4}}].map((function(t){return e.parse_usb(t)})),s=t.disks.map((function(t){return e.parse_disk(t)})),o=[(0,n.Z)({bus:0,target:0,unit:0,target_dev:"hda"},t.cdrom)].map((function(t,e){return{disk:{_attributes:{type:"file",device:"cdrom"},driver:{_attributes:{name:"qemu",type:"raw"}},source:{_attributes:{file:"".concat(t.filename),index:"".concat(e)}},backingStore:{},target:{_attributes:{dev:"".concat(t.target_dev),bus:"".concat(t.bus_options),tray:"open"}},readonly:{},boot:{_attributes:{order:"".concat(t.boot_order)}},alias:{_attributes:{name:"".concat(t.bus_options).concat(t.bus,"-").concat(t.target,"-").concat(t.unit)}}}}})),c=[{type:"sata",alias_name:"ide",address:{type:"pci",bus:"0x00",slit:"0x1f",function:"0x2"}}].map((function(t,a){return{controller:(0,n.Z)({_attributes:{type:"".concat(t.type),index:"".concat(a)},alias:{_attributes:"".concat(t.alias_name)}},e.parse_address(t.address))}})),u=[{model:"pcie-root",alias_name:"pcie.0"},{model:"pcie-root-port",model_name:"pcie-root-port",alias_name:"pci.1",target:{chassis:"1",port:"0x10"},address:{type:"pci",bus:"0x00",slot:"0x02",function:"0x0",multifunction:"on"}},{model:"pcie-root-port",model_name:"pcie-root-port",alias_name:"pci.2",target:{chassis:"2",port:"0x11"},address:{type:"pci",bus:"0x00",slot:"0x02",function:"0x1"}},{model:"pcie-root-port",model_name:"pcie-root-port",alias_name:"pci.3",target:{chassis:"3",port:"0x12"},address:{type:"pci",bus:"0x00",slot:"0x02",function:"0x2"}},{model:"pcie-root-port",model_name:"pcie-root-port",alias_name:"pci.4",target:{chassis:"4",port:"0x13"},address:{type:"pci",bus:"0x00",slot:"0x02",function:"0x3"}},{model:"pcie-root-port",model_name:"pcie-root-port",alias_name:"pci.5",target:{chassis:"5",port:"0x14"},address:{type:"pci",bus:"0x00",slot:"0x02",function:"0x4"}}].map((function(t,a){return e.parse_pci((0,n.Z)((0,n.Z)({},t),{},{index:a}))})),l=(0,r.Z)(t.nic).map((function(t,a){return e.parse_network(t)})),d=[{type:"pty",path:"/dev/pts/2",alias_name:"serial0",port:"0",target_type:"isa-serial"},{type:"pty",path:"/dev/pts/2",tty:"/dev/pts/2",alias_name:"serial0",port:"0",target_type:"serial"}].map((function(t){return e.parse_serial(t)})),p=[{path:"org.qemu.guest_agent.0"}].map((function(t){return e.parse_channel(t)})),_=[{}].map((function(t){return e.parse_console(t)})),m=[{type:"tablet",bus:"usb",alias_name:"input0",address:{type:"usb",bus:"0",port:"1"}},{type:"mouse",bus:"ps2",alias_name:"input1"},{type:"keyboard",bus:"ps2",alias_name:"input2"}].map((function(t){return e.parse_input(t)})),b=(0,n.Z)((0,n.Z)({},this.template),{},{name:{_text:"".concat(t.name)},metadata:{},memory:{_attributes:{unit:"KiB"},_text:"".concat(1024*t.memory)},currentMemory:{_attributes:{unit:"KiB"},_text:"".concat(1024*t.memory)},vcpu:{_attributes:{placement:"static"},_text:"".concat(t.smp)},cputune:{vcpuin:[{_attributes:{vcpu:"".concat(0),cpuset:"".concat(0)}}]},os:{type:{_attributes:{arch:"x86_64",machine:"".concat(t.machine)},_text:"hvm"},loader:{_attributes:{readonly:"yes",type:"pflash"},_text:"/usr/share/qemu/ovmf-x64/OVMF_CODE-pure-efi.fd"},nvram:{_text:"/etc/libvirt/qemu/nvram/99c36dce-e5af-5de4-b61f-17ea21137658_VARS-pure-efi.fd"}},features:{acpi:{},apic:{}},cpu:{_attributes:{mode:"host-passthrough",check:"none",migratable:"on"},topology:{_attributes:{sockets:"1",dies:"1",cores:"1",threads:"1"}},cache:{_attributes:{mode:"passthrough"}}},clock:{_attributes:{offset:"utc"},timer:[{_attributes:{name:"rtc",tickpolicy:"catchup"}},{_attributes:{name:"pit",tickpolicy:"delay"}},{_attributes:{name:"hpet",tickpolicy:"no"}}]},on_poweroff:{_text:"destroy"},on_reboot:{_text:"restart"},on_crash:{_text:"restart"},devices:(0,n.Z)((0,n.Z)((0,n.Z)((0,n.Z)((0,n.Z)((0,n.Z)((0,n.Z)((0,n.Z)({emulator:{_text:"/usr/local/sbin/qemu"},disk:(0,r.Z)(s),cdrom:(0,r.Z)(o)},a),c),u),l),d),p),_),m)}),f=(0,i.js2xml)(b,{compact:!0,ignoreComment:!0,spaces:4});console.log("ret==",f)}};e.default=l}}]);
//# sourceMappingURL=597.a7f0aabb.chunk.js.map