"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[894,591],{36141:function(e,t,n){n.r(t);var i=n(1413),a=n(29439),c=n(47313),r=n(65489),o=n(63469),s=n(63705),l=n(37982),d=n(69393),u=(n(3591),n(94536)),f=n(46817),v=n(84724),h=n(46417),w=l.context_value.global_data,p=(l.context_value.api,l.context_value.make_watch_data),x=[4,6,8,10,12,14,16,18,24],m=function(e){var t=e.data,n=function(){var e=(0,c.useState)(0),n=(0,a.Z)(e,2),i=n[0],r=n[1];return(0,c.useEffect)((function(){t.watch("perRow",(function(e){r(i+1)}));return function(){t.unwatch("perRow")}}),[t.perRow]),(0,h.jsx)("select",{className:"form-control d-inline-block w-auto me-3",value:t.perRow,onChange:function(e){return t.set("perRow",Number(e.target.value))},children:x.map((function(e){return(0,h.jsx)("option",{value:e,children:e},e)}))})},r=function(){var e=(0,c.useState)(0),n=(0,a.Z)(e,2),i=n[0],r=n[1];(0,c.useEffect)((function(){var e=t.watch("orientation",(function(e){r(i+1)}));return function(){t.unwatch("orientation",e)}}),[t.orientation]);return(0,h.jsxs)("select",{className:"form-control d-inline-block w-auto",value:t.orientation,onChange:function(e){e.preventDefault(),t.set("orientation",e.target.value)},children:[(0,h.jsx)("option",{value:"vertical",children:"\u5782\u76f4"}),(0,h.jsx)("option",{value:"horizontal",children:"\u6c34\u5e73"})]})},o=(0,c.useRef)(null),s=(0,i.Z)((0,i.Z)({},v.default),{},{$ref:"#/definitions/diskarray_setting"}),l={perRow:t.perRow,orientation:t.orientation,disks:[]};return(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"bg-dark p-3 mb-4 rounded d-inline-block text-start",children:[(0,h.jsx)("label",{className:"text-white me-2",children:"\u6bcf\u884c\u78c1\u76d8\u6570:"}),(0,h.jsx)(n,{}),(0,h.jsx)("label",{className:"text-white me-2",children:"\u78c1\u76d8\u65b9\u5411:"}),(0,h.jsx)(r,{})]}),(0,h.jsx)(f.default,{schema:s,ref:o,data:l})]})},j=function(e){var t=e.disk,n=e.orientation,i=p({readActive:!1,writeActive:!1}),r=u.default.get_disk_usage(t.path),o=r.used/r.size;(0,c.useEffect)((function(){var e=w.watch("sysstat",(function(e){var n=e.filter((function(e){return t.path=="/dev/"+e.Device}))[0];if(n){var a=parseFloat(n["kB_read/s"]),c=parseFloat(n["kB_wrtn/s"]);a>0?i.set("readActive",!0):i.set("readActive",!1),c>0?i.set("writeActive",!0):i.set("writeActive",!1)}}));return function(){w.unwatch("sysstat",e)}}),[n]);var s=function(){var e=(0,c.useState)(0),t=(0,a.Z)(e,2),r=t[0],o=t[1],s=i.readActive,l=i.writeActive;return(0,c.useEffect)((function(){var e=i.watch("readActive",(function(e){e!=s&&(s=e,o(r+1))})),t=i.watch("writeActive",(function(e){e!=l&&(l=e,o(r+1))}));return function(){i.unwatch("readActive",e),i.unwatch("writeActive",t)}})),(0,h.jsxs)("div",{className:"disk-leds-".concat(n," m-1 gap-1 "),children:[(0,h.jsx)("div",{className:"led led-read ".concat(i.readActive?"active":"")}),(0,h.jsx)("div",{className:"led led-write ".concat(i.writeActive?"active":"")})]})};return(0,h.jsxs)("div",{className:"disk bg-dark border bd-black rounded d-flex justify-center align-center shadow-3 pos-relative ".concat("vertical"===n?"disk-vertical":"disk-horizontal"),"data-role":"hint","data-hint":"\u54c1\u724c: ".concat(t.serial,"\n\u5bb9\u91cf: ").concat(t.size,"\n\u8bfb: ").concat(t.read,"MB/s\n\u5199: ").concat(t.write,"MB/s\n\u4f7f\u7528\u7387: ").concat(Math.round(100*t.usage),"%"),"data-hint-position":"top",children:[(0,h.jsxs)("div",{className:"disk-body-".concat(n),children:[(0,h.jsx)("div",{className:"disk-usage bg-gray",style:"vertical"===n?{height:"".concat(100*o,"%"),width:"100%"}:{width:"".concat(100*o,"%"),height:"100%"}}),(0,h.jsxs)("div",{className:"disk-label text-white text-bold text-center",children:[(0,h.jsx)("div",{children:t.model}),(0,h.jsx)("div",{children:t.size}),(0,h.jsx)("div",{children:t.path})]})]}),(0,h.jsx)(s,{})]})},g=(0,c.forwardRef)((function(e,t){var n=c.createRef(),l=(0,c.useState)("vertical"),u=(0,a.Z)(l,2),f=(u[0],u[1],w.get("blockdevices",[]).filter((function(e){return!e.ro&&e["id-link"]}))),v=w.get("pools");console.log("poools=",v);var x=p({disks:f,perRow:4,orientation:"vertical"});console.log("global.disks=",f);var g=function(){for(var e=(0,c.useState)(0),t=(0,a.Z)(e,2),n=t[0],i=t[1],r=[],o=0;o<x.disks.length;o+=x.perRow)r.push(x.disks.slice(o,o+x.perRow));return(0,c.useEffect)((function(){var e=x.watch("perRow",(function(e){i(n+1)})),t=x.watch("orientation",(function(e){i(n+1)}));return function(){x.unwatch("row",e),x.unwatch("orientation",t)}}),[x.orientation,x.perRow]),(0,h.jsx)("div",{className:"d-flex flex-column align-center gap-3",children:r.map((function(e,t){return(0,h.jsx)("div",{className:"d-flex justify-center gap-3",children:e.map((function(e,t){return(0,h.jsx)(j,{disk:e,orientation:x.orientation},t)}))},t)}))})},k=(d.WindowApi.windows,d.WindowApi.getApps,d.WindowApi.openWindow,d.WindowApi.set_window_ref,d.WindowApi.openDialog);d.WindowApi.closeDialog;return(0,h.jsx)(r.default,(0,i.Z)((0,i.Z)({},e),{},{ref:t,children:(0,h.jsxs)("div",{className:"bg-black text-center p-4 min-vh-100",ref:n,children:[(0,h.jsx)("h4",{className:"text-white mb-3",children:"\u78c1\u76d8\u9635\u5217\u76d1\u63a7\u9762\u677f"}),(0,h.jsx)(o.default,{className:"button mif-cog success",onClick:function(){var e="dialog_"+Date.now();k({id:e,content:(0,h.jsxs)(s.default,{width:"fit-content",children:[(0,h.jsx)("div",{type:"content",children:(0,h.jsx)(m,{data:x})}),(0,h.jsx)("button",{type:"action",className:"button js-dialog-close",children:" \u5173\u95ed"})]})})},children:"\u8bbe\u7f6e"}),(0,h.jsx)(g,{})]})}))}));t.default=g},3591:function(e,t,n){n.r(t),t.default={}}}]);