"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[547],{71547:function(n,t,e){e.r(t);var c=e(29439),i=e(1413),a=e(74165),r=e(15861),o=e(47313),s=e(69393),u=e(63469),f=e(63705),l=e(47610),p=(e(86385),e(56659),e(84724)),d=e(37982),g=(e(66109),e(94536),e(46817)),h=(e(60786),e(66641),e(60270),e(147),e(70816)),m=e.n(h),x=e(56573),v=e(46417),w=(d.context_value.global_data,d.context_value.api),Z=d.context_value.make_watch_data,_={config:Z({config:{}}),get_config:function(){return(0,r.Z)((0,a.Z)().mark((function n(){var t;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w.config_file({filename:"/app/config.json",op:"get"});case 3:return t=n.sent,_.config.set("config",t),console.log("set config====",t,_.config),n.abrupt("return",t);case 9:return n.prev=9,n.t0=n.catch(0),console.log("error===",n.t0),n.abrupt("return",null);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},save_config:function(n){return(0,r.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.config_file({op:"put",filename:"/app/config.json",data:JSON.stringify(n,null,2)});case 2:return t.next=4,_.get_config();case 4:case"end":return t.stop()}}),t)})))()},test_mail:function(){return(0,r.Z)((0,a.Z)().mark((function n(){var t;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.Z.post("/api/notify",{subject:"this is  for test notify from web at ".concat(m()()),message:"test in system control \u8fd9\u4e2a\u662f\u4e2d\u6587\u4ee5\u53ca\u8868\u60c5\u7b26\u53f7 \ud83c\udf39",attach:"/app/test.sh"});case 2:t=n.sent,console.log("send_ret==",t);case 4:case"end":return n.stop()}}),n)})))()},edit_auto_start:function(){return(0,r.Z)((0,a.Z)().mark((function n(){var t,e,c,r,u,l;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t="/app/scripts/auto_start.sh",n.next=3,w.config_file({filename:t,op:"get"});case 3:e=n.sent,s.WindowApi.windows,s.WindowApi.getApps,s.WindowApi.openWindow,s.WindowApi.set_window_ref,c=s.WindowApi.openDialog,r=s.WindowApi.closeDialog,u="dialog_"+Date.now(),l=function(n){var c=(0,o.useRef)(null),a=(0,i.Z)((0,i.Z)({},p.default),{},{$ref:"#/definitions/sh_script"});return(0,v.jsxs)(f.default,{className:"w-100",id:n.id,children:[(0,v.jsx)("div",{type:"title",children:"\u81ea\u52a8\u542f\u52a8\u914d\u7f6e"}),(0,v.jsx)("div",{type:"content",className:"w-100",children:(0,v.jsx)(g.default,{schema:a,ref:c,data:e})}),(0,v.jsx)("button",{type:"action",className:"button success",onClick:function(){var n=c.current.getValue();w.config_file({filename:t,op:"put",data:n}),r(u)},children:" \u4fdd\u5b58 "}),(0,v.jsx)("button",{type:"action",className:"button js-dialog-close",children:" \u5173\u95ed "})]})},c({id:u,content:(0,v.jsx)(l,{id:u})});case 8:case"end":return n.stop()}}),n)})))()},Setting:function(n){var t=(0,o.useState)(0),e=(0,c.Z)(t,2),s=e[0],f=e[1];(0,o.useEffect)((function(){var n=_.config.watch("config",(function(){console.log("config update!!!!"),f(s+1)}));return function(){_.config.unwatch("config",n)}}));var l=(0,i.Z)((0,i.Z)({},p.default),{},{$ref:"#/definitions/system_settings"}),d=_.config.config;console.log("system.config==",_.config);var h=(0,o.useRef)(null),m=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(){var t;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=h.current.getValue(),_.save_config(t);case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),x=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:_.test_mail();case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,v.jsxs)("div",{className:"w-100 h-100",children:[(0,v.jsx)("div",{type:"content",children:(0,v.jsx)(g.default,{schema:l,ref:h,data:d})}),(0,v.jsx)(u.default,{type:"action",className:"button success",onClick:x,children:"\u6d4b\u8bd5\u901a\u77e5"}),(0,v.jsx)(u.default,{type:"action",className:"button success",onClick:m,children:"\u4fdd\u5b58"}),(0,v.jsx)(u.default,{type:"action",className:"button success",onClick:function(){_.edit_auto_start()},children:"\u7f16\u8f91\u81ea\u52a8\u542f\u52a8\u811a\u672c"}),(0,v.jsx)("button",{type:"action",className:"button js-dialog-close",children:"\u5173\u95ed"})]})},Render:function(n){return _.get_config(),(0,v.jsx)(_.Setting,(0,i.Z)({},n))},Zram:function(n){var t=Z({config:{}}),e=(0,o.useRef)(null);console.log("new zram==",Date.now());var s=(0,i.Z)((0,i.Z)({},p.default),{},{$ref:"#/definitions/system_other/zram"}),f=function(){w.config_file({filename:"/app/config/zram.config",op:"get"}).then((function(n){t.set("config",n)})).catch((function(n){}))};f();var d=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(){var t;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.current.getValue(),n.next=3,w.config_file({op:"put",filename:"/app/config/zram.config",data:JSON.stringify(t,null,2)});case 3:f();case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),h=function(){return(0,v.jsx)(u.default,{className:"button success",onClick:d,children:"\u4fdd\u5b58"})},m=function(){var n=(0,o.useState)(0),i=(0,c.Z)(n,2),a=i[0],r=i[1],u=t.get("config");return(0,o.useEffect)((function(){var n=t.watch("config",(function(){r(a+1)}));return function(){t.unwatch("config",n)}})),(0,v.jsx)(g.default,{schema:s,ref:e,data:u})};return(0,v.jsxs)(l.default,{collapsible:!0,children:[(0,v.jsx)("div",{type:"title",children:"zram"}),(0,v.jsx)(h,{type:"button"}),(0,v.jsx)(m,{})]})},Other:function(n){return(0,v.jsx)("div",{className:"w-100 h-100",children:(0,v.jsx)(_.Zram,{})})}};t.default=_}}]);