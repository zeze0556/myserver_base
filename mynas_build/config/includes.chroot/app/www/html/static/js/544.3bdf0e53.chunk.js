"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[544,8,569,425,889],{89008:function(t,e,n){n.r(e);var a=n(37762),r=n(93433),u=n(1413),s=n(29439),o=n(47313),c=n(51629),i=n(70501),d=n(66835),l=n(23477),f=n(24076),p=n(67478),h=n(57861),m=n(69099),v=n(99783),x=n(37982),_=n(46417);e.default=function(t){var e=(0,x.useData)(),n=e.global_data,b=(e.api,(0,o.useState)([])),g=(0,s.Z)(b,2),w=g[0],Z=(g[1],(0,o.useState)(!0)),j=(0,s.Z)(Z,2),k=(j[0],j[1],(0,o.useState)(0)),y=(0,s.Z)(k,2),C=y[0],S=y[1],D=(0,o.useState)(10),N=(0,s.Z)(D,2),T=N[0],E=N[1],I=(0,o.useState)({online:!1,status_text:"\u79bb\u7ebf"}),R=(0,s.Z)(I,2),O=(R[0],R[1],(0,o.useState)({data:[],disks:t.data||[]})),z=(0,s.Z)(O,2),F=z[0],M=z[1],W=function(t){M((function(e){return(0,u.Z)((0,u.Z)({},e),t)}))},A=(0,o.useState)(""),B=(0,s.Z)(A,2),P=B[0],G=(B[1],F.disks.filter((function(t){return Object.values(t).some((function(t){return t.toString().toLowerCase().includes(P.toLowerCase())}))})));return(0,o.useEffect)((function(){W({disks:t.data});n.get("blockdevices");var e=function(e){var s,o=n.get("blockdevices"),c=w,i=(0,r.Z)(F.disks),d=(0,a.Z)(t.data);try{var l=function(){var t=s.value,e=i.findIndex((function(e){return e.path==t.path}));e<0&&i.push(t)};for(d.s();!(s=d.n()).done;)l()}catch(p){d.e(p)}finally{d.f()}var f=e;c.forEach((function(t){var e=f.filter((function(e){return t.path=="/dev/".concat(e.Device)}))[0];if(o){var n=o.filter((function(e){return e.path===t.path}))[0];if(e&&n){var a=i.findIndex((function(e){return e.path==t.path}));a>=0?i.splice(a,1,(0,u.Z)((0,u.Z)({},n),{},{id:t.path},e)):i.push((0,u.Z)((0,u.Z)({},n),{},{id:t.path},e))}}})),W({disks:(0,r.Z)(i)})};return n.watch("sysstat",e),function(){n.unwatch("sysstat",e)}}),[t.data]),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(c.Z,{component:i.Z,children:(0,_.jsxs)(d.Z,{children:[(0,_.jsx)(l.Z,{children:(0,_.jsxs)(f.Z,{children:[(0,_.jsx)(p.Z,{children:"\u8bbe\u5907"}),(0,_.jsx)(p.Z,{children:"PATH"}),(0,_.jsx)(p.Z,{children:"\u6807\u8bc6"}),(0,_.jsx)(p.Z,{children:"\u5bb9\u91cf"}),(0,_.jsx)(p.Z,{children:"\u8bfb\u53d6"}),(0,_.jsx)(p.Z,{children:"\u5199\u5165"})]})}),(0,_.jsx)(h.Z,{children:G.slice(C*T,C*T+T).map((function(e){return(0,_.jsxs)(f.Z,{children:[(0,_.jsxs)(p.Z,{children:[t.onDown&&(0,_.jsx)(m.Z,{onClick:function(){return t.onDown(e)},children:"\u4e0b\u7ebf"}),t.onAdd&&t.check_add_status&&t.check_add_status(e)&&(0,_.jsx)(m.Z,{onClick:function(){return t.onAdd(e)},children:"\u6dfb\u52a0\u5230\u6c60"}),t.onRemove&&(0,_.jsx)(m.Z,{onClick:function(){return t.onRemove(e)},children:"\u79fb\u9664"})]}),(0,_.jsx)(p.Z,{children:e.path}),(0,_.jsxs)(p.Z,{children:[e.model," ",e.serial," ",e.size]}),(0,_.jsx)(p.Z,{children:e.size}),(0,_.jsx)(p.Z,{children:e["kB_read/s"]}),(0,_.jsx)(p.Z,{children:e["kB_wrtn/s"]})]},e.path)}))})]})}),(0,_.jsx)(v.Z,{component:"div",count:G.length,page:C,onPageChange:function(t,e){S(e)},rowsPerPage:T,onRowsPerPageChange:function(t){E(parseInt(t.target.value,10)),S(0)},style:{marginTop:"1rem"}})]})}},9569:function(t,e,n){n.r(e);var a=n(74165),r=n(15861),u=n(29439),s=n(47313),o=n(69099),c=n(71889),i=n(37982),d=n(89008),l=n(46417);e.default=function(t){var e=t.data;console.log("pool=",e);var n=(0,i.useData)(),f=n.global_data,p=n.api,h=(0,s.useState)([]),m=(0,u.Z)(h,2),v=m[0],x=m[1];(0,s.useEffect)((function(){x(t.data.label)}),[t.data]);var _=function(){var t=(0,r.Z)((0,a.Z)().mark((function t(n){var r,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.run_command(c.default.device.evacuate({device:n.path,mount_path:e.mount_path}));case 2:if(0!=t.sent.ret){t.next=17;break}return t.next=6,p.run_command(c.default.device.remove({device:n.path,mount_path:e.mount_path}));case 6:if(0!=t.sent.ret){t.next=17;break}return(r=e.label.findIndex((function(t){return t.path==n.path})))>=0&&e.label.splice(r,1),u=f.get("pools"),(r=u.findIndex((function(t){return t.name===e.name})))>=0&&u.splice(r,1,e),t.next=15,p.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(u)});case 15:0==t.sent.ret&&(x(e.label),f.set("pools",u));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=(0,s.useState)({online:!1,status_text:"\u79bb\u7ebf"}),n=(0,u.Z)(t,2),i=n[0],d=n[1],f=function(){var t=(0,r.Z)((0,a.Z)().mark((function t(){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.mount_path,t.next=3,p.run_command(c.default.fs.usage(n));case 3:0==(r=t.sent).ret?(r.data.stdout.split("\n"),d({online:!0,status_text:"\u5728\u7ebf"})):d({online:!1,status_text:"\u79bb\u7ebf"});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var t=(0,r.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,p.run_command(c.default.mount(e));case 3:return t.sent,t.next=6,f();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=(0,r.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,p.run_command(c.default.umount(e));case 3:return t.sent,t.next=6,f();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,s.useEffect)((function(){var t=setInterval((function(){f()}),6e4);return f(),function(){clearInterval(t)}}),[]),(0,l.jsxs)("div",{children:["\u540d\u79f0:",e.name," \u6302\u8f7d\u4f4d\u7f6e: ",e.mount_path," \u72b6\u6001:",i.online&&(0,l.jsx)(o.Z,{onClick:m,children:"\u5378\u8f7d"}),!i.online&&(0,l.jsx)(o.Z,{onClick:h,children:"\u6302\u8f7d"})]})};return(0,l.jsxs)("div",{children:[(0,l.jsx)(b,{}),(0,l.jsx)(d.default,{data:v,onDown:function(t){console.log("down==",t)},onRemove:_}),";"]})}},32544:function(t,e,n){n.r(e);var a=n(93433),r=n(37762),u=n(29439),s=n(74165),o=n(15861),c=n(1413),i=n(47313),d=n(65489),l=(n(43772),n(47425),n(63469)),f=n(63705),p=n(47610),h=n(86385),m=n(56659),v=n(69393),x=n(84724),_=n(37982),b=(n(89008),n(9569),n(46817)),g=(n(71889),n(55293)),w=n(94536),Z=n(46417),j=function(t){var e=(0,v.useWindowManager)(),n=(e.windows,e.getApps,e.openWindow,e.set_window_ref,e.openDialog,e.closeDialog),a=(0,i.useRef)(null),r=(0,c.Z)((0,c.Z)({},x.default),{},{$ref:"#/definitions/".concat(t.schema)}),u=(0,i.useContext)(_.DataContext),d=(u.global_data,u.api,t.data),l=(0,c.Z)({},d),p=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.current.getValue(),"balance"==t.type){e.next=7;break}if(""==r.device){e.next=7;break}return e.next=5,t.onSave(r);case 5:if(!e.sent){e.next=7;break}n(t.id);case 7:return e.next=9,t.onSave(r);case 9:if(!e.sent){e.next=11;break}n(t.id);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return"replace"==t.type&&"\u66ff\u6362\u786c\u76d8",(0,Z.jsxs)(f.default,{id:t.id,children:[(0,Z.jsx)("div",{type:"title"}),(0,Z.jsx)("div",{type:"content",children:(0,Z.jsx)(b.default,{schema:r,ref:a,data:l})}),(0,Z.jsx)("button",{type:"action",className:"button warning",onClick:p,children:"\u786e\u5b9a"}),(0,Z.jsx)("button",{type:"action",className:"button js-dialog-close",children:"\u53d6\u6d88"})]})},k={btrfs:{command:"btrfs",args:["filesystem","show"],Rend:function(t){var e=t.data,n=(0,_.rix_make_watch_data)((0,c.Z)((0,c.Z)({},e),{},{status:"ok",info:""})),a=(0,_.useData)(),r=a.global_data,d=a.api,k=(r.disks_health,r.pools||[]),y=k.findIndex((function(t){return t.uuid==e.uuid}));y>=0&&n.set("name",k[y].name);var C=function(){g.default.info(n.mount_path).then(function(){var t=(0,o.Z)((0,s.Z)().mark((function t(e){var a,u,o,i,d,l,f;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=19;break}if(u=null!==(a=null===n||void 0===n?void 0:n.devices)&&void 0!==a?a:[],o=e,(i=u.filter((function(t){return o.devices.findIndex((function(e){return e.path==t.path}))<0}))).length>0&&w.default.update_blockdevice(i,null),!((d=r.pools.findIndex((function(t){return t.uuid==n.uuid})))>=0)){t.next=16;break}return l=r.pools[d],console.log("ready get info==",n),t.next=11,g.default.info(n.mount_path);case 11:f=t.sent,console.log("old_pool data=",l,"newinfo==",f),r.pools.splice(d,1,(0,c.Z)((0,c.Z)({},l),f)),r.update("pools"),n.set("name",l.name);case 16:n.set("devices",e.devices),t.next=20;break;case 19:n.set("devices",null);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},S=function t(){var e=setTimeout((0,o.Z)((0,s.Z)().mark((function a(){var r;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(e),a.next=3,d.run_command(g.default.balance.status({mount_path:n.mount_path}));case 3:if(!((r=a.sent).ret>=0)){a.next=13;break}if(!(r.data.stdout.indexOf("No balance")>=0)){a.next=12;break}return n.set("status","ok"),n.set("info",""),C(),a.abrupt("return");case 12:n.set("info",r.data.stdout);case 13:t();case 14:case"end":return a.stop()}}),a)}))),1e4);n.set("balance_timer",e)},D=function t(){var e=setTimeout((0,o.Z)((0,s.Z)().mark((function a(){var r;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(e),a.next=3,d.run_command(g.default.device.replace.status({mount_path:n.mount_path}));case 3:if(!((r=a.sent).ret>=0)){a.next=13;break}if(!(r.data.stdout.indexOf("finished on")>=0)){a.next=12;break}return n.set("status","ok"),n.set("info",""),C(),a.abrupt("return");case 12:n.set("info",r.data.stdout);case 13:t();case 14:case"end":return a.stop()}}),a)}))),1e3);n.set("replace_timer",e)},N=function t(){var e=setTimeout((0,o.Z)((0,s.Z)().mark((function a(){var r;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(e),a.next=3,d.run_command(g.default.device.remove_status({mount_path:n.mount_path}));case 3:if(!((r=a.sent).ret>=0)){a.next=13;break}if(""!=r.data.stdout.trim()){a.next=12;break}return n.set("status","ok"),n.set("info",""),C(),a.abrupt("return");case 12:n.set("info",r.data.stdout);case 13:t();case 14:case"end":return a.stop()}}),a)}))),1e3);n.set("remove_timer",e)};(0,i.useEffect)((function(){C(),d.run_command(g.default.balance.status({mount_path:n.mount_path})).then((function(t){t.ret>=0&&t.data.stdout.indexOf("running")>=0&&(S(),n.set("info",t.data.stdout),n.set("status","balance"))})),d.run_command(g.default.device.replace.status({mount_path:n.mount_path})).then((function(t){t.ret>=0&&t.data.stdout.indexOf("running")>=0&&(D(),n.set("info",t.data.stdout),n.set("status","replacing"))})),d.run_command(g.default.device.remove_status({mount_path:n.mount_path})).then((function(t){t.ret>=0&&""!=t.data.stdout.trim()&&(N(),n.set("info",t.data.stdout),n.set("status","remove"))}));var t=r.watch("pools",(function(){var t=r.pools.filter((function(t){return t.uuid==n.uuid}))[0];t&&(n.name!=t.name&&n.set("name",t.name),n.mount_path!=t.mount_path&&n.set("mount_path",t.mount_path))}));return function(){n.balance_timer&&(clearTimeout(n.balance_timer),n.set("balance_timer",null)),n.replace_timer&&(clearTimeout(n.replace_timer),n.set("replace_timer",null)),n.remove_timer&&(clearTimeout(n.remove_timer),n.set("remove_timer",null)),r.unwatch("pools",t)}}));var T=function(){var t=(0,i.useState)(0),a=(0,u.Z)(t,2),_=(a[0],a[1],(0,v.useWindowManager)()),k=(_.windows,_.getApps,_.openWindow,_.set_window_ref,_.openDialog),y=_.closeDialog,T=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),a=e[0],r=e[1];(0,i.useEffect)((function(){var t=n.watch("name",(function(){r(a+1)})),e=n.watch("devices",(function(){r(a+1)}));return function(){n.unwatch("name",t),n.unwatch("devices",e)}}));var s="";return s=n.name?"".concat(n.name," \u6302\u8f7d\u4f4d\u7f6e:").concat(n.mount_path):"\u6302\u8f7d\u4f4d\u7f6e:".concat(n.mount_path," \u5206\u533a\u7c7b\u578b:").concat(n.type),n.devices||(s+="\uff08\u672a\u6302\u8f7d\uff09"),s},E=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(e,a){var r,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.row,u="#/bin/bash\nnohup btrfs device remove ".concat(r.devid," ").concat(n.mount_path," &> /dev/null &\n"),t.next=4,d.config_file({filename:"/tmp/device_remove.sh",op:"put",data:u});case 4:if(0!=t.sent.ret){t.next=10;break}return t.next=8,d.run_command({command:"bash",args:["/tmp/device_remove.sh"]});case 8:0==t.sent.ret&&(n.set("status","remove"),N());case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),I=function(t){var e=t.row;return w.default.RendHealth(e)},R=function(t){var e=t.row;return w.default.RendStats(e)},O=function(t){var e=t.row,a=(0,i.useState)(0),r=(0,u.Z)(a,2),s=r[0],o=r[1];return(0,i.useEffect)((function(){var t=n.watch("status",(function(){o(s+1)}));return function(){n.unwatch("status",t)}})),"ok"!=n.status?(0,Z.jsx)(Z.Fragment,{}):n.devices.length>1?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(l.default,{className:"button success",onClick:function(t){return E(t,{row:e})},children:"\u79fb\u9664"}),(0,Z.jsx)(l.default,{className:"button success",onClick:function(t){return G(t,{row:e})},children:"\u66ff\u6362"})]}):(0,Z.jsx)(Z.Fragment,{})},z=function(t){var e,a,u,s,o,l,p=(0,i.useRef)(null),h=t.data,m={type:null!==(e=h.type)&&void 0!==e?e:"btrfs",mount_path:null!==(a=null===h||void 0===h?void 0:h.mount_path)&&void 0!==a?a:"",mount_option:null!==(u=null===h||void 0===h?void 0:h.mount_option)&&void 0!==u?u:"",name:null!==(s=null===h||void 0===h?void 0:h.name)&&void 0!==s?s:"",uuid:null!==(o=null===h||void 0===h?void 0:h.uuid)&&void 0!==o?o:"",auto_mount:null!==(l=null===h||void 0===h?void 0:h.auto_mount)&&void 0!==l&&l},v=(0,c.Z)((0,c.Z)({},x.default),{},{$ref:"#/definitions/".concat(t.schema)});return"modify_pool"==t.schema&&"\u4fee\u6539\u5b58\u50a8\u6c60",(0,Z.jsxs)(f.default,{id:t.id,children:[(0,Z.jsx)("div",{type:"title",children:(0,Z.jsx)(T,{})}),(0,Z.jsx)("div",{type:"content",children:(0,Z.jsx)(b.default,{schema:v,ref:p,data:m})}),(0,Z.jsx)("button",{type:"action",className:"button primary",onClick:function(){var e=p.current.getValue(),a=r.pools||[],u=a.findIndex((function(t){return t.uuid==e.uuid}));u>=0?a.splice(u,1,e):a.push(e),n.set("name",e.name),n.set("mount_path",e.mount_path),r.set("pools",a),d.config_file({filename:"/app/config/pools.config",op:"put",data:JSON.stringify(a)}).then((function(e){0==e.ret&&y(t.id)}))},children:"\u4fdd\u5b58"}),(0,Z.jsx)("button",{type:"action",className:"button js-dialog-close",onClick:function(){},children:"\u53d6\u6d88"})]})},F=function(){var t="dialog_"+Date.now();k({id:t,content:(0,Z.jsx)(z,{data:e,schema:"add_to_pool",id:t})})},M=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.run_command(g.default.device.add({device:e.device,mount_path:e.mount_path}));case 2:if(0!=t.sent.ret){t.next=6;break}return C(),t.abrupt("return",!0);case 6:return t.abrupt("return",!1);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),W=function(){var t="dialog_"+Date.now(),e={uuid:n.uuid,mount_path:n.mount_path};k({id:t,content:(0,Z.jsx)(j,{data:e,schema:"pool_add_device",id:t,onSave:M})})},A=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.run_command(g.default.balance.start({mount_path:n.mount_path,data_convert:e.data_convert}));case 2:if(0!=t.sent.ret){t.next=7;break}return n.set("status","balance"),S(),t.abrupt("return",!0);case 7:return t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),B=function(){var t="dialog_"+Date.now(),e={uuid:n.uuid,mount_path:n.mount_path};k({id:t,content:(0,Z.jsx)(j,{data:e,schema:"btrfs_balance",id:t,onSave:A,type:"balance"})})},P=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(e){var a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.target_device){t.next=2;break}return t.abrupt("return",!1);case 2:if(null!=(a=n.devices.filter((function(t){return t.path==e.device}))[0])){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,d.run_command(g.default.device.replace.start({device:a.devid,target_device:e.target_device,mount_path:e.mount_path}));case 7:if(0!=t.sent.ret){t.next=12;break}return n.set("status","replacing"),D(),t.abrupt("return",!0);case 12:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),G=function(t,e){var a=e.row,r="dialog_"+Date.now(),u={uuid:n.uuid,mount_path:n.mount_path,device:a.path};k({id:r,content:(0,Z.jsx)(j,{data:u,schema:"pool_replace_device",id:r,onSave:P})})},J=function(){return(r.pools||[]).findIndex((function(t){return t.uuid==e.uuid}))>=0?(0,Z.jsx)(Z.Fragment,{}):(0,Z.jsx)(l.default,{className:"button success",onClick:F,children:"\u6ce8\u518c"})},K=function(){var t=r.pools||[],n=t.findIndex((function(t){return t.uuid==e.uuid}));if(n>=0){return(0,Z.jsx)(l.default,{className:"button success",onClick:function(){!function(t){var e="dialog_"+Date.now();k({id:e,content:(0,Z.jsx)(z,{data:t,schema:"modify_pool",id:e})})}(t[n])},children:"\u4fee\u6539"})}return(0,Z.jsx)(Z.Fragment,{})},$=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),a=e[0],r=e[1];return(0,i.useEffect)((function(){var t=n.watch("status",(function(){r(a+1)}));n.watch("devices",(function(){r(a+1)}));return function(){n.unwatch("status",t),n.unwatch("devices",t)}})),n.devices&&"ok"==n.status?(0,Z.jsx)(l.default,{className:"button success",onClick:B,children:"\u5747\u8861"}):(0,Z.jsx)(Z.Fragment,{})},H=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),a=e[0],r=e[1];return(0,i.useEffect)((function(){var t=n.watch("status",(function(){r(a+1)}));n.watch("devices",(function(){r(a+1)}));return function(){n.unwatch("state",t),n.unwatch("devices",t)}})),n.devices&&"ok"==n.status?(0,Z.jsx)(l.default,{className:"button success",onClick:W,children:"\u6dfb\u52a0"}):(0,Z.jsx)(Z.Fragment,{})},L=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),a=e[0],r=e[1];return(0,i.useEffect)((function(){var t=n.watch("info",(function(){r(a+1)}));return function(){n.unwatch("info",t)}})),n.info&&""!=n.info?(0,Z.jsx)("span",{children:n.info}):(0,Z.jsx)(Z.Fragment,{})},V=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.default.umount(n);case 2:0==(e=t.sent).ret?(n.set("devices",null),n.set("state","unmount"),C()):n.set("info",JSON.stringify(e));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),U=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.default.mount(n);case 2:0==(e=t.sent).ret?(n.set("state","ok"),C()):n.set("info",JSON.stringify(e));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),a=e[0],r=e[1];return(0,i.useEffect)((function(){var t=n.watch("status",(function(){r(a+1)}));n.watch("devices",(function(){r(a+1)}));return function(){n.unwatch("status",t),n.unwatch("devices",t)}})),"ok"==n.status?n.devices?(0,Z.jsx)(l.default,{className:"button success",onClick:V,children:"\u5378\u8f7d"}):(0,Z.jsx)(l.default,{className:"button success",onClick:U,children:"\u6302\u8f7d"}):(0,Z.jsx)(Z.Fragment,{})},q=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),a=e[0],r=e[1];return(0,i.useEffect)((function(){var t=n.watch("devices",(function(){r(a+1)}));return function(){n.unwatch("devices",t)}})),n.devices?(0,Z.jsxs)(h.default,{data:n.devices,children:[(0,Z.jsx)(h.default.TableColumn,{label:"devid",prop:"devid"}),(0,Z.jsx)(h.default.TableColumn,{label:"path",prop:"path"}),(0,Z.jsx)(h.default.TableColumn,{label:"\u5df2\u7528",prop:"used"}),(0,Z.jsx)(h.default.TableColumn,{label:"size",prop:"size"}),(0,Z.jsx)(h.default.TableColumn,{label:"\u5065\u5eb7\u5ea6(\u5df2\u6d88\u8017)",children:(0,Z.jsx)(m.default,{"slot-scope":"{row}",children:(0,Z.jsx)(I,{})})}),(0,Z.jsx)(h.default.TableColumn,{label:"\u8bfb/\u5199\u901f\u5ea6",children:(0,Z.jsx)(m.default,{"slot-scope":"{row}",children:(0,Z.jsx)(R,{})})}),(0,Z.jsxs)(h.default.TableColumn,{label:"\u7f16\u8f91",children:[(0,Z.jsx)(m.default,{slot:"header","slot-scope":"scope"}),(0,Z.jsx)(m.default,{"slot-scope":"{row}",children:(0,Z.jsx)(O,{})})]})]}):(0,Z.jsx)("div",{children:"\u672a\u6302\u8f7d"})},Q=function(){return(0,Z.jsxs)(p.default,{collapsible:!0,children:[(0,Z.jsx)(T,{type:"title"}),(0,Z.jsx)("div",{type:"icon",class:"mif-apps"}),(0,Z.jsx)(J,{type:"button"}),(0,Z.jsx)(Y,{type:"button"}),(0,Z.jsx)(H,{type:"button"}),(0,Z.jsx)(K,{type:"button"}),(0,Z.jsx)($,{type:"button"}),(0,Z.jsx)(L,{}),(0,Z.jsx)(q,{})]})};return(0,Z.jsx)(Q,{})};return(0,Z.jsx)(T,{})}},bcachefs:{command:"bcachefs",args:["fs","usage","-h"],parse:function(t){console.log("bcachefs res=",t);var e=t.match(/Filesystem:\s*([a-f0-9-]+)/i),n=e?e[1]:null,a=t.match(/Size:\s*([\d.]+\s*[TGMK]iB)/i),r=a?a[1]:null,u=t.match(/Used:\s*([\d.]+\s*[TGMK]iB)/i),s=u?u[1]:null,o=t.match(/Online reserved:\s*([\d.]+\s*[TGMK]iB)/i),i=o?o[1]:null;function d(t,e){var n=t.slice(e).match(/free:\s*([\d.]+\s*[TGMK]iB)/),a=t.slice(e).match(/capacity:\s*([\d.]+\s*[TGMK]iB)/);return{free:n?n[1].trim():null,capacity:a?a[1].trim():null}}for(var l,f=/([\w.-]+(?:_[\w.-]+)*)\s*\(device\s+(\d+)\):\s*(\w+)\s+(rw|ro)/g,p=[];null!==(l=f.exec(t));){var h=d(t,l.index);p.push((0,c.Z)({type:l[1],deviceId:l[2],deviceName:l[3],mode:l[4]},h))}return console.log("devices==",JSON.stringify(p)),{uuid:n,size:r,used:s,reserved:i,devices:p}},Rend:function(t){var e=t.data;return(0,Z.jsxs)(p.default,{children:[(0,Z.jsx)("div",{children:e.mount_path}),(0,Z.jsx)("div",{children:e.type})]})}}},y=(0,i.forwardRef)((function(t,e){var n=(0,_.useData)(),p=n.global_data,h=n.api,m=(0,v.useWindowManager)(),x=(m.windows,m.getApps,m.openWindow,m.set_window_ref,m.openDialog),b=m.closeDialog,w=(0,_.rix_make_watch_data)({disks:[],drawOpen:!1,all_disk:!0,show_pools:!1,openAddDialog:!1,schema:{},scan_pool_list:[],data:{id:0,key:"",status:0,type:0,value:"",parent_id:0}}),j=function(t){for(var e in t)w.set(e,t[e])};(0,i.useEffect)((function(){var t=function(t){j({disks:t})};return p.watch("blockdevices",t),function(){p.unwatch("blockdevices",t)}}),[]);var y=function(){var t=(0,o.Z)((0,s.Z)().mark((function t(){var e,n,a,u,o,i,d,l;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.run_command({command:"mount",args:[]});case 2:if(e=t.sent,n=function(t){var e=t.match(/\(([^)]+)\)/);return e?e[1]:null},0!=e.ret){t.next=28;break}a=e.data.stdout.split("\n").map((function(t){var e=t.split(/\s+/);return e[0].startsWith("/dev/")?{mount_path:e[2],type:e[4],mount_option:n(e[5])}:null})).filter((function(t){return t})),p.set("mounted_device",a),u=e.data.stdout.split("\n").map((function(t){var e=t.split(/\s+/);return"btrfs"==e[4]?{mount_path:e[2],type:e[4],mount_option:n(e[5])}:null})).filter((function(t){return t})),console.log("pool info=",u),o=[],i=(0,r.Z)(u),t.prev=11,l=(0,s.Z)().mark((function t(){var e,n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("btrfs"!=(e=d.value).type){t.next=6;break}return t.next=4,g.default.info(e.mount_path);case 4:(n=t.sent)&&(console.log("global_data.pools=",p.pools,"cur=",n),p.pools.filter((function(t){return t.uuid==n.uuid}))[0]||o.push((0,c.Z)((0,c.Z)({},e),n)));case 6:case"end":return t.stop()}}),t)})),i.s();case 14:if((d=i.n()).done){t.next=18;break}return t.delegateYield(l(),"t0",16);case 16:t.next=14;break;case 18:t.next=23;break;case 20:t.prev=20,t.t1=t.catch(11),i.e(t.t1);case 23:return t.prev=23,i.f(),t.finish(23);case 26:console.log("scan_pool_list==",o),j({scan_pool_list:o});case 28:case"end":return t.stop()}}),t,null,[[11,20,23,26]])})));return function(){return t.apply(this,arguments)}}(),C=function(){var t=(0,i.useState)(0),e=(0,u.Z)(t,2),n=e[0],s=e[1],o=[];(0,i.useEffect)((function(){var t=w.watch("scan_pool_list",(function(){s(n+1)}));return function(){w.unwatch(t)}})),console.log("global_data==",p);var c,d=[].concat((0,a.Z)(p.pools),(0,a.Z)(w.scan_pool_list)),l=(0,r.Z)(d);try{for(l.s();!(c=l.n()).done;){var f=c.value;console.log("ready pool==",f);var h=k[f.type].Rend;o.push((0,Z.jsx)("div",{children:(0,Z.jsx)(h,{data:f})},f.uuid))}}catch(m){l.e(m)}finally{l.f()}return o};return console.log("Render StroageWindow=",Date.now()),(0,Z.jsx)(d.default,(0,c.Z)((0,c.Z)({},t),{},{ref:e,children:(0,Z.jsxs)("div",{style:{height:"100%"},children:[(0,Z.jsx)(l.default,{className:"button success",onClick:y,children:"\u626b\u63cf"}),(0,Z.jsx)(l.default,{className:"button success",onClick:function(){var t="dialog_"+Date.now();x({id:t,content:(0,Z.jsxs)(f.default,{id:t,children:[(0,Z.jsx)("div",{type:"ttitle",children:"aaaa"}),(0,Z.jsx)("div",{type:"content",children:"dddd"}),(0,Z.jsx)("button",{type:"action",onClick:function(){b(t)},children:" test"})]})})},children:"\u65b0\u589e"}),(0,Z.jsx)(C,{})]})}))}));e.default=y},47425:function(t,e,n){n.r(e),n.d(e,{default:function(){return f}});var a=n(1413),r=n(45987),u=n(29439),s=n(47313),o=(n(1168),n(52794),n(46417)),c=["children","onClick","toggle_ref","shift_ref"],i=window,d=i.Metro,l=i.$;function f(t){var e=(0,s.useState)(0),n=(0,u.Z)(e,2),i=(n[0],n[1],s.createRef()),f=t.children,p=t.onClick,h=t.toggle_ref,m=t.shift_ref,v=(0,r.Z)(t,c);(0,s.useEffect)((function(){d.makePlugin(i.current,"sidebar",(0,a.Z)({shift:m.current,toggle:h.current,menuItemClick:!1},v)).data("sidebar").element.on("click",".sidebar-menu li  > a",(function(t){t.preventDefault();var e=l(t.target);p&&p(e.data("menu"),t)}))}));var x=f.filter((function(t){return"header"==t.props.slot})),_=f.filter((function(t){return"header"!=t.props.slot}));return(0,o.jsxs)("aside",{className:"sidebar pos-absolute z-2",ref:i,children:[x,(0,o.jsxs)("ul",{className:"sidebar-menu",children:[_," "]})]})}},71889:function(t,e,n){n.r(e);var a=n(37762),r={command:"bcachefs",fs:{usage:function(t){var e=[];return e.push("fs"),e.push("usage"),e.push(t),{command:"bcachefs",args:e}}},device:{remove:function(t){var e=[];return e.push("device"),e.push("remove"),e.push(t.device),e.push(t.mount_path),{command:"bcachefs",args:e}},add:function(t){var e=[];return e.push("device"),e.push("add"),t.label&&""!=t.label&&e.push("--label=".concat(t.label)),t.fs_size&&""!=t.fs_size&&e.push("--fs_size=".concat(t.fs_size)),t.discard&&1==t.discard&&e.push("--discard"),t.bucket&&""!=t.bucket&&e.push("--bucket=".concat(t.bucket)),e.push(t.mount_path),e.push(t.device),{command:"bcachefs",args:e}},online:function(t){var e=[];return e.push("device"),e.push("online"),e.push(t.device),{command:"bcachefs",args:e}},offline:function(t){var e=[];return e.push("device"),e.push("offline"),e.push(t.device),{command:"bcachefs",args:e}},evacuate:function(t){var e=[];return e.push("device"),e.push("evacuate"),e.push(t.device),{command:"bcachefs",args:e}}},format:function(t){var e=[];e.push("format"),e.push("-f"),e.push("--compression=".concat(t.compression)),t.encrypted&&e.push("--encrypted"),e.push("--foreground_target=".concat(t.foreground_target)),e.push("--promote_target=".concat(t.promote_target)),e.push("--background_target=".concat(t.background_target)),e.push("--replicas=".concat(t.replicas));var n,r=(0,a.Z)(t.label);try{for(r.s();!(n=r.n()).done;){var u=n.value;e.push("--label=".concat(u.name)),e.push("".concat(u.path))}}catch(s){r.e(s)}finally{r.f()}return{command:this.command,args:e}},list:function(t){var e=[];return e.push("list"),e.push(t.path),{command:this.command,args:e}},list_journal:function(t){var e=[];return e.push("list_journal"),e.push(t.path),{command:this.command,args:e}},mount:function(t){var e=[];return e.push("-t"),e.push("bcachefs"),e.push(t.label.map((function(t){return t.path})).join(":")),e.push(t.mount_path),{command:"mount",args:e}},umount:function(t){var e=[];return e.push(t.mount_path),{command:"umount",args:e}}};e.default=r}}]);