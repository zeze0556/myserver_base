"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[362],{62362:function(t,n,e){e.r(n);var r=e(1413),s=e(74165),u=e(15861),c=e(29439),a=e(47313),i=e(60786),o=e(60270),d=(e(147),e(66641),e(65489)),f=e(63469),l=e(66109),p=e(37982),h=e(46417),m=function(t){var n=(0,a.useRef)(null),e=(0,a.useRef)(null),r=(0,a.useState)(""),s=(0,c.Z)(r,2);s[0],s[1];return(0,a.useEffect)((function(){n.current=new i.Terminal({rows:40,convertEol:!0,scrollback:10,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0});var r=new o.FitAddon;n.current.loadAddon(r),n.current.onResize((function(t){r.fit()})),n.current.open(e.current),l.default.long_cmd(t.data,{stdout:function(t){n.current&&n.current.write(t)},stderr:function(t){},onerr:function(t){},onend:function(){t.onEnd&&t.onEnd()}})})),(0,h.jsx)("div",{ref:e,width:"100%",height:"100%",children:"bbbbbb"})},v=(0,a.forwardRef)((function(t,n){var e=a.createRef(),i=(0,p.useData)(),o=(i.global_data,i.api),v=(0,p.rix_make_watch_data)({step:"check"}),x=function(){var t=(0,u.Z)((0,s.Z)().mark((function t(){var n,e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={command:"/usr/bin/ttyd",args:["-v"]},t.next=3,o.run_command(n);case 3:if(0!=(e=t.sent).ret){t.next=6;break}return t.abrupt("return",{ret:0,data:e.data.stdout});case 6:return v.set("step","install"),t.abrupt("return",{ret:-2,step:"install"});case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),w=function(){var t=(0,u.Z)((0,s.Z)().mark((function t(){var n,e,r,u=arguments;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=u.length>0&&void 0!==u[0]?u[0]:1,e=u.length>1&&void 0!==u[1]?u[1]:3,v.set("step","connect"),r={command:"ls",args:["/var/run/ttyd.sock"]},t.next=6,o.run_command(r);case 6:0==t.sent.ret?v.set("step","openurl"):(n>=e&&v.set("step","error"),l.default.long_cmd({command:"/app/scripts/start_ttyd.sh",args:[]},{stdout:function(t){},onend:function(){w(n+1)}}));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),b=function(){var t=(0,u.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x();case 2:if(0!=t.sent.ret){t.next=6;break}return t.next=6,w();case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){v.set("step","installing")};(0,a.useEffect)((function(){return b(),function(){}}),[]);var y=function(t){var n=(0,a.useState)(0),e=(0,c.Z)(n,2),r=e[0],s=e[1],u=v.step;if((0,a.useEffect)((function(){var t=v.watch("step",(function(){s(r+1)}));return function(){v.unwatch("step",t)}})),"install"==u)return(0,h.jsxs)("div",{className:"pos-center d-flex flex-justify-center",children:[(0,h.jsx)("div",{children:"ttyd\u672a\u5b89\u88c5\uff0c\u7acb\u523b\u5b89\u88c5\uff1f"}),(0,h.jsx)(f.default,{className:"button success",onClick:g,children:"\u5b89\u88c5"})]});if("installing"==u){return(0,h.jsx)(m,{data:{command:"wget",args:["-O","/usr/bin/ttyd","https://github.com/tsl0922/ttyd/releases/download/1.7.7/ttyd.x86_64"]},onEnd:b})}if("connect"==u)return(0,h.jsx)("div",{children:"connect"});if("openurl"==u){return(0,h.jsx)("iframe",{src:"/ttyd",style:{width:"100%",height:"100%"},frameborder:"0",scrolling:"no"})}return(0,h.jsx)("div",{})};return(0,h.jsx)(d.default,(0,r.Z)((0,r.Z)({},t),{},{ref:n,children:(0,h.jsx)("div",{style:{height:"100%",overflow:"hidden"},ref:e,children:(0,h.jsx)(y,{})})}))}));n.default=v}}]);