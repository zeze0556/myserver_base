"use strict";(self.webpackChunkmypxe_admin=self.webpackChunkmypxe_admin||[]).push([[569,8,889],{89008:function(n,e,t){t.r(e);var a=t(37762),r=t(93433),s=t(1413),u=t(29439),c=t(47313),o=t(51629),i=t(70501),d=t(66835),h=t(23477),f=t(24076),l=t(67478),p=t(57861),m=t(69099),v=t(99783),Z=t(37982),x=t(46417);e.default=function(n){var e=(0,Z.useData)(),t=e.global_data,g=(e.api,(0,c.useState)([])),_=(0,u.Z)(g,2),b=_[0],j=(_[1],(0,c.useState)(!0)),k=(0,u.Z)(j,2),w=(k[0],k[1],(0,c.useState)(0)),y=(0,u.Z)(w,2),C=y[0],S=y[1],D=(0,c.useState)(10),I=(0,u.Z)(D,2),z=I[0],P=I[1],E=(0,c.useState)({online:!1,status_text:"\u79bb\u7ebf"}),R=(0,u.Z)(E,2),A=(R[0],R[1],(0,c.useState)({data:[],disks:n.data||[]})),B=(0,u.Z)(A,2),L=B[0],O=B[1],T=function(n){O((function(e){return(0,s.Z)((0,s.Z)({},e),n)}))},F=(0,c.useState)(""),H=(0,u.Z)(F,2),J=H[0],N=(H[1],L.disks.filter((function(n){return Object.values(n).some((function(n){return n.toString().toLowerCase().includes(J.toLowerCase())}))})));return(0,c.useEffect)((function(){T({disks:n.data});t.get("blockdevices");var e=function(e){var u,c=t.get("blockdevices"),o=b,i=(0,r.Z)(L.disks),d=(0,a.Z)(n.data);try{var h=function(){var n=u.value,e=i.findIndex((function(e){return e.path==n.path}));e<0&&i.push(n)};for(d.s();!(u=d.n()).done;)h()}catch(l){d.e(l)}finally{d.f()}var f=e;o.forEach((function(n){var e=f.filter((function(e){return n.path=="/dev/".concat(e.Device)}))[0];if(c){var t=c.filter((function(e){return e.path===n.path}))[0];if(e&&t){var a=i.findIndex((function(e){return e.path==n.path}));a>=0?i.splice(a,1,(0,s.Z)((0,s.Z)({},t),{},{id:n.path},e)):i.push((0,s.Z)((0,s.Z)({},t),{},{id:n.path},e))}}})),T({disks:(0,r.Z)(i)})};return t.watch("sysstat",e),function(){t.unwatch("sysstat",e)}}),[n.data]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(o.Z,{component:i.Z,children:(0,x.jsxs)(d.Z,{children:[(0,x.jsx)(h.Z,{children:(0,x.jsxs)(f.Z,{children:[(0,x.jsx)(l.Z,{children:"\u8bbe\u5907"}),(0,x.jsx)(l.Z,{children:"PATH"}),(0,x.jsx)(l.Z,{children:"\u6807\u8bc6"}),(0,x.jsx)(l.Z,{children:"\u5bb9\u91cf"}),(0,x.jsx)(l.Z,{children:"\u8bfb\u53d6"}),(0,x.jsx)(l.Z,{children:"\u5199\u5165"})]})}),(0,x.jsx)(p.Z,{children:N.slice(C*z,C*z+z).map((function(e){return(0,x.jsxs)(f.Z,{children:[(0,x.jsxs)(l.Z,{children:[n.onDown&&(0,x.jsx)(m.Z,{onClick:function(){return n.onDown(e)},children:"\u4e0b\u7ebf"}),n.onAdd&&n.check_add_status&&n.check_add_status(e)&&(0,x.jsx)(m.Z,{onClick:function(){return n.onAdd(e)},children:"\u6dfb\u52a0\u5230\u6c60"}),n.onRemove&&(0,x.jsx)(m.Z,{onClick:function(){return n.onRemove(e)},children:"\u79fb\u9664"})]}),(0,x.jsx)(l.Z,{children:e.path}),(0,x.jsxs)(l.Z,{children:[e.model," ",e.serial," ",e.size]}),(0,x.jsx)(l.Z,{children:e.size}),(0,x.jsx)(l.Z,{children:e["kB_read/s"]}),(0,x.jsx)(l.Z,{children:e["kB_wrtn/s"]})]},e.path)}))})]})}),(0,x.jsx)(v.Z,{component:"div",count:N.length,page:C,onPageChange:function(n,e){S(e)},rowsPerPage:z,onRowsPerPageChange:function(n){P(parseInt(n.target.value,10)),S(0)},style:{marginTop:"1rem"}})]})}},9569:function(n,e,t){t.r(e);var a=t(74165),r=t(15861),s=t(29439),u=t(47313),c=t(69099),o=t(71889),i=t(37982),d=t(89008),h=t(46417);e.default=function(n){var e=n.data;console.log("pool=",e);var t=(0,i.useData)(),f=t.global_data,l=t.api,p=(0,u.useState)([]),m=(0,s.Z)(p,2),v=m[0],Z=m[1];(0,u.useEffect)((function(){Z(n.data.label)}),[n.data]);var x=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(t){var r,s;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.run_command(o.default.device.evacuate({device:t.path,mount_path:e.mount_path}));case 2:if(0!=n.sent.ret){n.next=17;break}return n.next=6,l.run_command(o.default.device.remove({device:t.path,mount_path:e.mount_path}));case 6:if(0!=n.sent.ret){n.next=17;break}return(r=e.label.findIndex((function(n){return n.path==t.path})))>=0&&e.label.splice(r,1),s=f.get("pools"),(r=s.findIndex((function(n){return n.name===e.name})))>=0&&s.splice(r,1,e),n.next=15,l.config_file({filename:"config/pools.config",op:"put",data:JSON.stringify(s)});case 15:0==n.sent.ret&&(Z(e.label),f.set("pools",s));case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),g=function(){var n=(0,u.useState)({online:!1,status_text:"\u79bb\u7ebf"}),t=(0,s.Z)(n,2),i=t[0],d=t[1],f=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(){var t,r;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.mount_path,n.next=3,l.run_command(o.default.fs.usage(t));case 3:0==(r=n.sent).ret?(r.data.stdout.split("\n"),d({online:!0,status_text:"\u5728\u7ebf"})):d({online:!1,status_text:"\u79bb\u7ebf"});case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),p=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(t){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.preventDefault(),n.next=3,l.run_command(o.default.mount(e));case 3:return n.sent,n.next=6,f();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),m=function(){var n=(0,r.Z)((0,a.Z)().mark((function n(t){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.preventDefault(),n.next=3,l.run_command(o.default.umount(e));case 3:return n.sent,n.next=6,f();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,u.useEffect)((function(){var n=setInterval((function(){f()}),6e4);return f(),function(){clearInterval(n)}}),[]),(0,h.jsxs)("div",{children:["\u540d\u79f0:",e.name," \u6302\u8f7d\u4f4d\u7f6e: ",e.mount_path," \u72b6\u6001:",i.online&&(0,h.jsx)(c.Z,{onClick:m,children:"\u5378\u8f7d"}),!i.online&&(0,h.jsx)(c.Z,{onClick:p,children:"\u6302\u8f7d"})]})};return(0,h.jsxs)("div",{children:[(0,h.jsx)(g,{}),(0,h.jsx)(d.default,{data:v,onDown:function(n){console.log("down==",n)},onRemove:x}),";"]})}},71889:function(n,e,t){t.r(e);var a=t(37762),r={command:"bcachefs",fs:{usage:function(n){var e=[];return e.push("fs"),e.push("usage"),e.push(n),{command:"bcachefs",args:e}}},device:{remove:function(n){var e=[];return e.push("device"),e.push("remove"),e.push(n.device),e.push(n.mount_path),{command:"bcachefs",args:e}},add:function(n){var e=[];return e.push("device"),e.push("add"),n.label&&""!=n.label&&e.push("--label=".concat(n.label)),n.fs_size&&""!=n.fs_size&&e.push("--fs_size=".concat(n.fs_size)),n.discard&&1==n.discard&&e.push("--discard"),n.bucket&&""!=n.bucket&&e.push("--bucket=".concat(n.bucket)),e.push(n.mount_path),e.push(n.device),{command:"bcachefs",args:e}},online:function(n){var e=[];return e.push("device"),e.push("online"),e.push(n.device),{command:"bcachefs",args:e}},offline:function(n){var e=[];return e.push("device"),e.push("offline"),e.push(n.device),{command:"bcachefs",args:e}},evacuate:function(n){var e=[];return e.push("device"),e.push("evacuate"),e.push(n.device),{command:"bcachefs",args:e}}},format:function(n){var e=[];e.push("format"),e.push("-f"),e.push("--compression=".concat(n.compression)),n.encrypted&&e.push("--encrypted"),e.push("--foreground_target=".concat(n.foreground_target)),e.push("--promote_target=".concat(n.promote_target)),e.push("--background_target=".concat(n.background_target)),e.push("--replicas=".concat(n.replicas));var t,r=(0,a.Z)(n.label);try{for(r.s();!(t=r.n()).done;){var s=t.value;e.push("--label=".concat(s.name)),e.push("".concat(s.path))}}catch(u){r.e(u)}finally{r.f()}return{command:this.command,args:e}},list:function(n){var e=[];return e.push("list"),e.push(n.path),{command:this.command,args:e}},list_journal:function(n){var e=[];return e.push("list_journal"),e.push(n.path),{command:this.command,args:e}},mount:function(n){var e=[];return e.push("-t"),e.push("bcachefs"),e.push(n.label.map((function(n){return n.path})).join(":")),e.push(n.mount_path),{command:"mount",args:e}},umount:function(n){var e=[];return e.push(n.mount_path),{command:"umount",args:e}}};e.default=r}}]);